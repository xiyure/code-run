"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),N=require("./tab_dropdown_menu.cjs"),R=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const u=require("../../utils/dom.cjs"),M=require("../../node_modules/lodash-es/throttle.cjs"),j=require("../../node_modules/element-plus/es/components/tabs/index.cjs"),U=require("../../node_modules/ksw-vue-icon/es/icons/base/ellipsis-horizontal.cjs"),A=t.defineComponent({name:"KTabs",__name:"tabs",props:{modelValue:{default:void 0},tabPosition:{default:"top"},maxWidth:{default:void 0},addable:{type:Boolean},editable:{type:Boolean},showHideList:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(V,{expose:k,emit:W}){const b=t.inject("__elementObserver"),v=V,P=W,g=t.ref(void 0),s=t.ref(),$=t.ref(),E=t.ref(),p=t.ref(!1),y=t.ref([]);let _=0;t.onMounted(()=>{var o;window.addEventListener("resize",w),window.addEventListener("wheel",S);const e=u.getElement(".el-tabs__nav",(o=s.value)==null?void 0:o.$el);e&&(b==null||b.observe(e,M.default(w,200)))}),t.onBeforeUnmount(()=>{var o;window.removeEventListener("resize",w),window.removeEventListener("wheel",S);const e=u.getElement(".el-tabs__nav",(o=s.value)==null?void 0:o.$el);e&&(b==null||b.unobserve(e))}),t.onUpdated(()=>{w()}),t.watch(()=>v.tabPosition,()=>{h()||t.nextTick(()=>{var n;const e=(n=s.value)==null?void 0:n.$el,o=u.getElement(".el-tabs__nav-wrap",e);e==null||e.style.setProperty("--dropdown-trigger-width",`${o==null?void 0:o.offsetWidth}px`)})},{immediate:!0}),t.watch(()=>v.modelValue,()=>{g.value=v.modelValue},{immediate:!0}),t.watch(()=>g.value,e=>{v.modelValue!==void 0&&v.modelValue!==e&&P("update:modelValue",e),z()});function S(e){var d;const o=(d=s.value)==null?void 0:d.$el,n=u.getElement(".el-tabs__nav",o),i=u.getElement(".el-tabs__nav-scroll",o);if(!n||!i||!(n!=null&&n.contains(e.target)))return;const f=e.deltaY,a=B();let l=a-f;const c=i.getBoundingClientRect();let r=h()?n.offsetWidth-c.width:n.offsetHeight-c.height;r<=0&&(r=-a),l>0?l=0:l<-r&&(l=-r),H(l)}function q(e){const o=e.name??"";g.value=o}function x(){var a;if(!v.showHideList)return;const e=[],o=(a=s.value)==null?void 0:a.$el,n=u.getElementAll(".el-tabs__item",o),i=u.getElement(".el-tabs__nav-scroll",o);if(!o||!i||!(n!=null&&n.length))return;const f=i.getBoundingClientRect();for(let l=0;l<n.length;l++){const c=n[l].getBoundingClientRect();u.isElementInContainerView(c,f,h()?"horizontal":"vertical")||e.push(l)}y.value=e}function z(){setTimeout(()=>{var m;const e=(m=s.value)==null?void 0:m.$el,o=u.getElement(".el-tabs__nav",e),n=u.getElement(".el-tabs__nav-scroll",e);if(!e||!n||!o)return;const i=u.getElement(".el-tabs__item.is-active",e);if(!i)return;const f=h(),a=i.getBoundingClientRect(),l=n.getBoundingClientRect();let c=f?o.offsetWidth-l.width:o.offsetHeight-l.height;const r=-B();c<=0&&(c=r);let d=r;f?(a.left<l.left&&(d=r-(l.left-a.left)),a.right>l.right&&(d=r+a.right-l.right)):(a.top<l.top&&(d=r-(l.top-a.top)),a.bottom>l.bottom&&(d=r+(a.bottom-l.bottom))),d=Math.max(d,0),H(-Math.min(d,c))},200)}function B(){var o;if(!((o=s.value)!=null&&o.$el))return 0;const e=s.value.$el.style.getPropertyValue("--translate")||0;return parseFloat(e)}function H(e){var o;(o=s.value)!=null&&o.$el&&s.value.$el.style.setProperty("--translate",`${e}px`)}function h(){return v.tabPosition==="top"||v.tabPosition==="bottom"}function w(){var d;const e=(d=s.value)==null?void 0:d.$el,o=u.getElement(".el-tabs__nav",e),n=u.getElement(".el-tabs__nav-scroll",e);if(!e||!o||!n)return;const{offsetWidth:i=0,offsetHeight:f=0}=E.value??{},{offsetWidth:a,offsetHeight:l}=n,{offsetWidth:c,offsetHeight:r}=o;if(h()){const m=_===i?0:i;p.value=c>a-m+(p.value?$.value.offsetWidth-i:0),_=i}else{const m=_===f?0:f;p.value=r>l-m+(p.value?$.value.offsetHeight-f:0),_=f}setTimeout(()=>{var C,T;const{offsetWidth:m,offsetHeight:L}=$.value??{};(T=(C=s.value)==null?void 0:C.$el)==null||T.style.setProperty("--extra-width",`${h()?m:L}px`)})}const O={};return k(R.getExposeProxy(O,s)),(e,o)=>(t.openBlock(),t.createBlock(t.unref(j.ElTabs),t.mergeProps({ref_key:"$tab",ref:s,modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=n=>g.value=n),class:"k-tabs"},e.$attrs,{"tab-position":e.tabPosition,editable:e.editable,addable:e.addable}),t.createSlots({default:t.withCtx(()=>[t.createElementVNode("div",{ref_key:"$list",ref:$,class:t.normalizeClass(["k-tabs-more",`tab-${e.tabPosition}-layout ${e.editable||e.addable?"is-addable":""}`])},[e.showHideList&&p.value?(t.openBlock(),t.createBlock(t.unref(N.default),{key:0,"tab-index-list":y.value,"tab-slots":e.$slots,onCommand:q},{title:t.withCtx(()=>[t.createVNode(t.unref(U.default),{onClick:x})]),_:1},8,["tab-index-list","tab-slots"])):t.createCommentVNode("",!0),t.createElementVNode("div",{ref_key:"$slotContent",ref:E,class:"k-tabs_header-right"},[t.renderSlot(e.$slots,"extra")],512)],2),t.renderSlot(e.$slots,"default")]),_:2},[e.$slots["add-icon"]?{name:"add-icon",fn:t.withCtx(()=>[t.renderSlot(e.$slots,"add-icon")]),key:"0"}:void 0]),1040,["modelValue","tab-position","editable","addable"]))}});exports.default=A;
