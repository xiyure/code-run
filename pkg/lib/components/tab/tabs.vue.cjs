"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});require("../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const R=require("./tab_dropdown_menu.cjs"),M=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const u=require("../../utils/dom.cjs"),j=require("../../node_modules/lodash-es/throttle.cjs"),U=require("../../node_modules/ksw-vue-icon/es/icons/base/ellipsis-horizontal.cjs"),A=require("../../node_modules/element-plus/es/components/tabs/index.cjs"),o=require("../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs"),v=require("../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),I=require("../../node_modules/@vue/runtime-core/node_modules/@vue/shared/dist/shared.esm-bundler.cjs"),Y=o.defineComponent({name:"KTabs",__name:"tabs",props:{modelValue:{default:void 0},tabPosition:{default:"top"},maxWidth:{default:void 0},addable:{type:Boolean},editable:{type:Boolean},showHideList:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(k,{expose:q,emit:W}){const h=o.inject("__elementObserver"),m=k,P=W,p=v.ref(void 0),s=v.ref(),$=v.ref(),y=v.ref(),_=v.ref(!1),B=v.ref([]);let w=0;o.onMounted(()=>{var t;window.addEventListener("resize",E),window.addEventListener("wheel",S);const e=u.getElement(".el-tabs__nav",(t=s.value)==null?void 0:t.$el);e&&(h==null||h.observe(e,j.default(E,200)))}),o.onBeforeUnmount(()=>{var t;window.removeEventListener("resize",E),window.removeEventListener("wheel",S);const e=u.getElement(".el-tabs__nav",(t=s.value)==null?void 0:t.$el);e&&(h==null||h.unobserve(e))}),o.onUpdated(()=>{E()}),o.watch(()=>m.tabPosition,()=>{g()||o.nextTick(()=>{var n;const e=(n=s.value)==null?void 0:n.$el,t=u.getElement(".el-tabs__nav-wrap",e);e==null||e.style.setProperty("--dropdown-trigger-width",`${t==null?void 0:t.offsetWidth}px`)})},{immediate:!0}),o.watch(()=>m.modelValue,()=>{p.value=m.modelValue},{immediate:!0}),o.watch(()=>p.value,e=>{m.modelValue!==void 0&&m.modelValue!==e&&P("update:modelValue",e),O()});function S(e){var d;const t=(d=s.value)==null?void 0:d.$el,n=u.getElement(".el-tabs__nav",t),i=u.getElement(".el-tabs__nav-scroll",t);if(!n||!i||!(n!=null&&n.contains(e.target)))return;const c=e.deltaY,a=C();let l=a-c;const f=i.getBoundingClientRect();let r=g()?n.offsetWidth-f.width:n.offsetHeight-f.height;r<=0&&(r=-a),l>0?l=0:l<-r&&(l=-r),H(l)}function x(e){const t=e.name??"";p.value=t}function z(){var a;if(!m.showHideList)return;const e=[],t=(a=s.value)==null?void 0:a.$el,n=u.getElementAll(".el-tabs__item",t),i=u.getElement(".el-tabs__nav-scroll",t);if(!t||!i||!(n!=null&&n.length))return;const c=i.getBoundingClientRect();for(let l=0;l<n.length;l++){const f=n[l].getBoundingClientRect();u.isElementInContainerView(f,c,g()?"horizontal":"vertical")||e.push(l)}B.value=e}function O(){setTimeout(()=>{var b;const e=(b=s.value)==null?void 0:b.$el,t=u.getElement(".el-tabs__nav",e),n=u.getElement(".el-tabs__nav-scroll",e);if(!e||!n||!t)return;const i=u.getElement(".el-tabs__item.is-active",e);if(!i)return;const c=g(),a=i.getBoundingClientRect(),l=n.getBoundingClientRect();let f=c?t.offsetWidth-l.width:t.offsetHeight-l.height;const r=-C();f<=0&&(f=r);let d=r;c?(a.left<l.left&&(d=r-(l.left-a.left)),a.right>l.right&&(d=r+a.right-l.right)):(a.top<l.top&&(d=r-(l.top-a.top)),a.bottom>l.bottom&&(d=r+(a.bottom-l.bottom))),d=Math.max(d,0),H(-Math.min(d,f))},200)}function C(){var t;if(!((t=s.value)!=null&&t.$el))return 0;const e=s.value.$el.style.getPropertyValue("--translate")||0;return parseFloat(e)}function H(e){var t;(t=s.value)!=null&&t.$el&&s.value.$el.style.setProperty("--translate",`${e}px`)}function g(){return m.tabPosition==="top"||m.tabPosition==="bottom"}function E(){var d;const e=(d=s.value)==null?void 0:d.$el,t=u.getElement(".el-tabs__nav",e),n=u.getElement(".el-tabs__nav-scroll",e);if(!e||!t||!n)return;const{offsetWidth:i=0,offsetHeight:c=0}=y.value??{},{offsetWidth:a,offsetHeight:l}=n,{offsetWidth:f,offsetHeight:r}=t;if(g()){const b=w===i?0:i;_.value=f>a-b+(_.value?$.value.offsetWidth-i:0),w=i}else{const b=w===c?0:c;_.value=r>l-b+(_.value?$.value.offsetHeight-c:0),w=c}setTimeout(()=>{var T,V;const{offsetWidth:b,offsetHeight:N}=$.value??{};(V=(T=s.value)==null?void 0:T.$el)==null||V.style.setProperty("--extra-width",`${g()?b:N}px`)})}const L={};return q(M.getExposeProxy(L,s)),(e,t)=>(o.openBlock(),o.createBlock(v.unref(A.ElTabs),o.mergeProps({ref_key:"$tab",ref:s,modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=n=>p.value=n),class:"k-tabs"},e.$attrs,{"tab-position":e.tabPosition,editable:e.editable,addable:e.addable}),o.createSlots({default:o.withCtx(()=>[o.createElementVNode("div",{ref_key:"$list",ref:$,class:I.normalizeClass(["k-tabs-more",`tab-${e.tabPosition}-layout ${e.editable||e.addable?"is-addable":""}`])},[e.showHideList&&_.value?(o.openBlock(),o.createBlock(v.unref(R.default),{key:0,"tab-index-list":B.value,"tab-slots":e.$slots,onCommand:x},{title:o.withCtx(()=>[o.createVNode(v.unref(U.default),{onClick:z})]),_:1},8,["tab-index-list","tab-slots"])):o.createCommentVNode("",!0),o.createElementVNode("div",{ref_key:"$slotContent",ref:y,class:"k-tabs_header-right"},[o.renderSlot(e.$slots,"extra")],512)],2),o.renderSlot(e.$slots,"default")]),_:2},[e.$slots["add-icon"]?{name:"add-icon",fn:o.withCtx(()=>[o.renderSlot(e.$slots,"add-icon")]),key:"0"}:void 0]),1040,["modelValue","tab-position","editable","addable"]))}});exports.default=Y;
