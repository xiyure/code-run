"use strict";var D=Object.defineProperty;var u=(n,t,e)=>t in n?D(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var p=(n,t,e)=>u(n,typeof t!="symbol"?t+"":t,e);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const g=require("../../../utils/utils.cjs");require("../../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../../node_modules/sortablejs/modular/sortable.esm.cjs");require("vue");require("../../../node_modules/culori/src/index.cjs");class c{constructor(t){p(this,"tableData");p(this,"treeDataMap");p(this,"tableDataMap");this.props=t,this.tableData=[],this.props=t,this.treeDataMap=new Map,this.tableDataMap=new Map}initTableData(t){this.tableData=t}initTableMap(){this.tableDataMap.clear(),this.tableDataMap=g.convertToMap(this.tableData,this.getRowField(),this.getParentField())}handleTreeData(t,e=!1){var o,d;if(this.treeDataMap.clear(),!Array.isArray(t)||t.length===0)return[];const{keyField:i="id"}=this.props.rowConfig??{},r=e?new Set(t.map(l=>l[i])):void 0,a=((o=this.props.treeConfig)==null?void 0:o.rowField)??"id",s=((d=this.props.treeConfig)==null?void 0:d.parentField)??"pid";for(let l=0;l<t.length;l++){const h=t[l];this.treeDataMap.get(h[a])||(this.treeDataMap.set(h[a],h),this.getParentNode(h,s,a))}return this.addChildNodes(t,r),g.sortFunc([...this.treeDataMap.values()],this.tableData,this.getRowField())}addChildNodes(t,e){var r;if(!t||!t.length)return;const i=((r=this.props.rowConfig)==null?void 0:r.keyField)??"id";for(const a of t){const s=this.tableDataMap.get(a[i]);s&&(s.children.forEach(o=>{!this.treeDataMap.get(o[i])&&(!e||e.has(o[i]))&&this.treeDataMap.set(o[i],o)}),this.addChildNodes(s.children,e))}}getParentNode(t,e,i){var s;const r=t[e],a=(s=this.tableDataMap.get(r))==null?void 0:s.node;a&&(this.treeDataMap.get(r)||this.treeDataMap.set(r,a),a[e]!==null&&this.getParentNode(a,e,i))}getRowField(){const{rowConfig:t,treeConfig:e}=this.props;return(e==null?void 0:e.rowField)??(t==null?void 0:t.keyField)??"id"}getParentField(){var t;return((t=this.props.treeConfig)==null?void 0:t.parentField)??"pid"}}exports.default=c;
