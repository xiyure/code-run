"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});require("../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const We=require("./column_group.cjs"),Xe=require("../operate/index.cjs"),et=require("../table/index.cjs"),tt=require("../pagination/index.cjs"),rt=require("./table_header.vue.cjs"),nt=require("./table_card.vue.cjs"),ot=require("./hooks/use_methods.cjs"),at=require("./hooks/use_checkbox.cjs"),lt=require("./hooks/use_data.cjs"),it=require("./hooks/use_config.cjs"),st=require("./hooks/use_header_control.cjs"),ut=require("./hooks/use_advanced_filter.cjs"),ct=require("../../hooks/use_size.cjs"),ft=require("../../hooks/use_locale.cjs"),ee=require("../../hooks/use_deprecated.cjs"),dt=require("../../hooks/use_inherit_slot.cjs"),gt=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const ht=require("./const.cjs"),pt=require("../../node_modules/lodash-es/cloneDeep.cjs"),t=require("../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs"),o=require("../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),p=require("../../node_modules/@vue/runtime-core/node_modules/@vue/shared/dist/shared.esm-bundler.cjs"),vt={key:0,ref:"RefTableBox",class:"table-box flex-1 overflow-hidden"},mt={key:0,class:"batch-operate"},Ct={key:2,ref:"RefTablePagination",class:"pagination-box"},wt=t.defineComponent({name:"KTreeTable",__name:"tree_table",props:{data:{},size:{},sortConfig:{},filterConfig:{},seqConfig:{},rowConfig:{},editConfig:{},scrollY:{},columnConfig:{},checkboxConfig:{},treeConfig:{},showOverflow:{type:[String,Boolean],default:!0},autoResize:{type:Boolean,default:!0},height:{default:"100%"},align:{},border:{type:[Boolean,String],default:"default"},emptyText:{},rowStyle:{},column:{},showPage:{type:Boolean,default:!0},useTree:{type:Boolean},isRemoteQuery:{type:Boolean},isServerPaging:{type:Boolean},paginationConfig:{},showDescription:{type:Boolean,default:!0},showHeaderTools:{type:Boolean,default:!0},batchOperations:{},showBatchOperation:{type:Boolean},batchOperateConfig:{},showColumnMenu:{type:Boolean,default:!1},showDragColumn:{type:Boolean},cellClickToggleHighlight:{type:Boolean,default:!0},widgets:{},showSearchInput:{type:Boolean,default:!0},showFilter:{type:Boolean,default:!0},showRefresh:{type:Boolean,default:!0},showTransfer:{type:Boolean,default:!1},showSizeControl:{type:Boolean},advancedFilterConfig:{},searchConfig:{},style:{},class:{},simple:{type:Boolean},defaultTransferData:{},onTransferShow:{},onTransferHide:{},onTransferChange:{},onAdvancedFilterShow:{},onAdvancedFilterHide:{},useAntStyle:{type:Boolean},round:{type:Boolean,default:!1},adaptive:{type:Boolean},hasSpace:{type:Boolean,default:!1},requestMethod:{},cardOptions:{},defaultMode:{default:"list"},transferConfig:{}},emits:["remote-query","server-paging","refresh","highlight-clear","highlight-change","cell-click","resizable-change","hide-column","checkbox-change","checkbox-all","row-dragend","sort-change","filter-change","clear-filter","advanced-filter-confirm","advanced-filter-clear","page-current-change","page-size-change","page-change","prev-click","next-click"],setup(te,{expose:re,emit:ne}){const a=te;ee.useDeprecated({scope:"k-tree-table",from:"isRemoteQuery",replacement:"searchConfig.isRemoteQuery",version:"2.0.0"},t.computed(()=>!!a.isRemoteQuery)),ee.useDeprecated({scope:"k-tree-table",from:"isServerPaging",replacement:"paginationConfig.isRemotePaging",version:"2.0.0"},t.computed(()=>!!a.isServerPaging));const{t:y}=ft.useLocale(),oe=dt.useInheritSlot(["default"]),u=ne,H=o.ref(),v=o.ref(a.size),F=o.ref(a.defaultMode==="card"?"card":"list"),m=o.ref(),b=o.ref([]),g=o.ref([]),S=o.ref(""),ae=t.computed(()=>{var l,s,n;const e=!!((s=(l=k.value)==null?void 0:l.conditionList)!=null&&s.length),r=((n=a.advancedFilterConfig)==null?void 0:n.remote)===!0;return e&&!r?C.value:g.value}),f=t.computed(()=>H.value),le=t.computed(()=>v.value??void 0),A=t.computed(()=>{const e=Q.value.map(r=>r.id);return!!(a.showHeaderTools&&e.includes("transfer"))}),ie=t.computed(()=>{const{placeholder:e=y==null?void 0:y("table.searchTable")}=a.searchConfig??{};return{placeholder:e}}),se=t.computed(()=>{const{remote:e,ignoreCase:r,dateFormat:l,timeFormat:s,defaultCondition:n}=a.advancedFilterConfig??{};return{conditionInfo:k.value,data:g.value,columns:be.value,text:Se.value,remote:e,ignoreCase:r,dateFormat:l,timeFormat:s,defaultCondition:n}}),ue=t.computed(()=>{const{drag:e=!0,showSearch:r=!0}=a.transferConfig??{};return{drag:e,showSearch:r,selectData:O.value,originData:ge.value,defaultHeader:he.value}}),E=t.computed(()=>F.value==="list"),{setTableData:ce,handleSortAndFilter:M,dragSort:fe,_methods:de}=ot.useMethods(a,f),{flatColumns:D,selectData:O,originData:ge,defaultHeader:he,updateTransfer:pe,transferChange:L,transferHide:ve,transferShow:me,sortTableHeader:Ce,updateColVisible:we,_transferMethods:ye}=st.useHeaderControl(f,m,a,b),{newFilterData:C,filterColumns:be,filterConditionInfo:k,headerText:Se,advancedFilterShow:ke,advancedFilterHide:Te,getAdvancedCondition:Be}=ut.useAdvancedFilter(m,a,b),{showTableData:d,isPaging:R,dataLength:I,paginationConfig:N,treeStore:V,changePageSize:Fe,changeCurrentPage:De,handleRemoteData:K}=lt.useData(f,a,u,D,g,ae,S,k,x),{widgets:Q,treeConfig:$,sortConfig:Re,rowConfig:Y,editConfig:qe,scrollY:ze,columnConfig:Pe,seqConfig:_e}=it.useConfig(a,{isPaging:R,paginationConfig:N}),{checkboxConfig:xe,batchOpConfig:j,closeBatchOperation:He,checkBoxChange:Ae,checkboxAllChange:Ee,initCheckedData:Me,clearCheckedData:q,resetCheckboxStatus:h,_checkboxMethods:Oe}=at.useCheckbox(f,a,g,d,V);t.onBeforeMount(()=>{W()}),t.watch([()=>a.data,()=>{var e;return(e=a.data)==null?void 0:e.length}],()=>{q(),x(a.data??[]),P(),Me()},{immediate:!0}),t.watch(()=>a.column,()=>{b.value=a.column.map(e=>{const r=e.visible!==!1,l=e.field??`_table_column_${e.type??""}`,s=e.editRender??(typeof e.renderEdit=="function"?{}:void 0);return{...pt.default(e),visible:r,field:l,editRender:s}}),pe()},{deep:!0});let T=!1;t.watch(()=>{var e;return(e=d.value)==null?void 0:e.length},()=>{var e;!a.useTree||(e=$.value)!=null&&e.lazy||!E.value||t.nextTick(()=>{var r,l;if(S.value.trim()||T){T=!1;const s=d.value.length>500?500:d.value.length,n=d.value.slice(0,s);(r=f.value)==null||r.setTreeExpand(n,!0)}else(l=f.value)==null||l.clearTreeExpand()})},{immediate:!0});function Le(e){if(!a.rowStyle){const{row:r}=e;return r.style||{}}return typeof a.rowStyle=="function"?a.rowStyle(e):a.rowStyle}function Ie(e){if(!A.value)return;const r=D.value.find(l=>l.field===e.field);r&&(r.visible=!1,O.value=D.value.filter(l=>l.visible!==!1).map(l=>l.title&&l.field?l.field:null).filter(l=>l!==null),u("hide-column",e))}async function z(e,r=[],l=!0){var n;k.value=e;const{remote:s}=a.advancedFilterConfig??{};if(s===!0){l&&u("advanced-filter-confirm",{conditionInfo:e,tableData:[]}),await K(),C.value=g.value;return}if(h(),C.value=r,a.useTree){const{isEvery:i=!1}=a.advancedFilterConfig??{};C.value=V.handleTreeData(C.value,i)}(n=e==null?void 0:e.conditionList)!=null&&n.length?T=!0:T=!1,l&&u("advanced-filter-confirm",{conditionInfo:e,tableData:[]})}function Ne(){_(),u("advanced-filter-clear")}let w=!1,B=null;function Ve({row:e,rowid:r}){var n,i,c;if(!a.cellClickToggleHighlight)return;w?w&&B===r&&((n=f.value)==null||n.setCurrentRow(null),w=!1,B=null,u("highlight-clear",e)):w=!0;const l=(i=f.value)==null?void 0:i.getCurrentRecord(),s=(c=f.value)==null?void 0:c.getRowid(l);B!==r&&s===r&&(B=r),u("highlight-change",e,w)}async function P(e){var i;const r=U();if(!r)return;await t.nextTick();const l=(i=r==null?void 0:r.filter)==null?void 0:i.call(r,e),{conditionInfo:s,data:n}=l??{};return await z(s,n,!1),{conditionInfo:s,tableData:n}}async function _(){var n;const e=U();if(!e)return;await t.nextTick(),h();const r=(n=e==null?void 0:e.clearFilter)==null?void 0:n.call(e),{conditionInfo:l,data:s}=r??{};return await z(l,s,!1),{conditionInfo:l,tableData:s}}function U(){var e,r;return(r=(e=m.value)==null?void 0:e.filterRef)==null?void 0:r[0]}function Z(e){S.value=e??"",h()}function G(){var e,r;(r=(e=m.value)==null?void 0:e.clearInput)==null||r.call(e),S.value=""}function Ke(e){M(),u("sort-change",e)}function J(e){M(),u("filter-change",e)}function Qe(e){fe(),u("row-dragend",e)}async function $e(e){await t.nextTick(),e==="list"&&h()}function Ye(){return d.value}function je(){return g.value}function Ue(e){Array.isArray(e)&&(x(e),P(e))}function x(e){g.value=ce(e)}async function W(e=!1){var n,i,c;const r=((n=a.searchConfig)==null?void 0:n.isRemoteQuery)||a.isRemoteQuery,l=((i=a.advancedFilterConfig)==null?void 0:i.remote)===!0;(R.value&&(a.isServerPaging||((c=a.paginationConfig)==null?void 0:c.isRemotePaging))||r||l)&&(e&&(q(),h()),K())}function Ze(){q(),_(),G()}t.provide("__showTransfer",A),t.provide(ct.SIZE_KEY,t.computed(()=>v.value==="small"||v.value==="mini"?"sm":"base")),t.provide(ht.TABLE_SIZE_KEY,v),t.provide("__hasSpace__",t.computed(()=>a.hasSpace));const Ge={tableInstance:f,filter:Z,advancedFilter:P,clearAdvancedFilter:_,getAdvancedCondition:Be,getVisibleData:Ye,getFullData:je,loadData:Ue,clearSearch:G,clearTableStatus:Ze,refreshTableData:W,...de,...Oe,...ye};return re(gt.getExposeProxy(Ge,f)),(e,r)=>{var s;const l=t.resolveDirective("ksw_drag");return t.openBlock(),t.createElementBlock("div",{class:p.normalizeClass(["k-tree-table flex h-full flex-col",a.class,{"tree-table-use-ant-style":e.useAntStyle,"has-space-between":e.hasSpace}]),style:p.normalizeStyle({height:e.adaptive?"fit-content":e.height,...e.style})},[t.createVNode(rt.default,{ref_key:"headerRef",ref:m,"current-mode":F.value,"onUpdate:currentMode":r[0]||(r[0]=n=>F.value=n),simple:e.simple,"show-search-input":e.showSearchInput,"show-description":e.showDescription,"show-header-tools":e.showHeaderTools,widgets:o.unref(Q),"data-length":o.unref(I),"show-total":!e.useTree,"search-config":ie.value,"filter-config":se.value,"transfer-config":ue.value,onInputChange:Z,onFilterConfirm:z,onFilterClear:Ne,onFilterShow:o.unref(ke),onFilterHide:o.unref(Te),onTransferChange:o.unref(we),onTransferShow:o.unref(me),onTransferHide:r[1]||(r[1]=()=>{o.unref(ve)(),o.unref(L)()}),onSizeChange:r[2]||(r[2]=n=>{v.value=n||void 0}),onTransferDrag:o.unref(Ce),onRefresh:r[3]||(r[3]=()=>{u("refresh")}),onSwitchChange:$e},t.createSlots({_:2},[t.renderList(e.$slots,(n,i)=>({name:i,fn:t.withCtx(c=>[t.renderSlot(e.$slots,i,p.normalizeProps(t.guardReactiveProps(c)))])}))]),1032,["current-mode","simple","show-search-input","show-description","show-header-tools","widgets","data-length","show-total","search-config","filter-config","transfer-config","onFilterShow","onFilterHide","onTransferChange","onTransferShow","onTransferDrag"]),E.value?(t.openBlock(),t.createElementBlock("div",vt,[t.createVNode(o.unref(et.KTable),t.mergeProps({ref_key:"xTree",ref:H,border:e.useAntStyle?"inner":e.border,size:le.value,data:o.unref(d),"row-config":o.unref(Y),"sort-config":o.unref(Re),"filter-config":e.filterConfig,"tree-config":o.unref($),"seq-config":o.unref(_e),"checkbox-config":o.unref(xe),"edit-config":o.unref(qe),"column-config":o.unref(Pe),"empty-text":e.emptyText||((s=o.unref(y))==null?void 0:s("table.noData")),"scroll-y":o.unref(ze),"row-style":Le,"show-overflow":e.showOverflow,"auto-resize":e.autoResize,"show-column-menu":e.showColumnMenu,align:e.align,round:e.useAntStyle||e.round,height:e.adaptive?void 0:"100%"},e.$attrs,{onCheckboxChange:r[4]||(r[4]=n=>{o.unref(Ae)(n),u("checkbox-change",n)}),onCheckboxAll:r[5]||(r[5]=n=>{o.unref(Ee)(n),u("checkbox-all",n)}),onHideColumn:Ie,onCellClick:r[6]||(r[6]=n=>{Ve(n),u("cell-click",n)}),onResizableChange:r[7]||(r[7]=n=>{o.unref(L)(),u("resizable-change",n)}),onSortChange:Ke,onFilterChange:J,onClearFilter:r[8]||(r[8]=n=>{J(n),u("clear-filter",n)}),onRowDragend:Qe}),t.createSlots({default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(b.value,(n,i)=>(t.openBlock(),t.createBlock(o.unref(We.default),{key:i,column:n,size:e.size,align:e.align},t.createSlots({_:2},[t.renderList(e.$slots,(c,X)=>({name:X,fn:t.withCtx(Je=>[t.renderSlot(e.$slots,X,p.normalizeProps(t.guardReactiveProps(Je)))])}))]),1032,["column","size","align"]))),128))]),_:2},[t.renderList(o.unref(oe)(e.$slots),(n,i)=>({name:i,fn:t.withCtx(c=>[t.renderSlot(e.$slots,i,p.normalizeProps(t.guardReactiveProps(c)))])}))]),1040,["border","size","data","row-config","sort-config","filter-config","tree-config","seq-config","checkbox-config","edit-config","column-config","empty-text","scroll-y","show-overflow","auto-resize","show-column-menu","align","round","height"]),(e.batchOperateConfig||e.showBatchOperation)&&o.unref(j).total>0?t.withDirectives((t.openBlock(),t.createElementBlock("div",mt,[t.createVNode(o.unref(Xe.KOperate),t.mergeProps(o.unref(j),{onClose:o.unref(He)}),null,16,["onClose"])])),[[l]]):t.createCommentVNode("",!0)],512)):(t.openBlock(),t.createBlock(nt.default,{key:1,data:o.unref(d),"key-field":o.unref(Y).keyField,"card-attrs":e.cardOptions},t.createSlots({_:2},[t.renderList(e.$slots,(n,i)=>({name:i,fn:t.withCtx(c=>[t.renderSlot(e.$slots,i,p.normalizeProps(t.guardReactiveProps(c)))])}))]),1032,["data","key-field","card-attrs"])),o.unref(R)?(t.openBlock(),t.createElementBlock("div",Ct,[t.createVNode(o.unref(tt.KPagination),t.mergeProps(o.unref(N),{total:o.unref(I),onCurrentChange:o.unref(De),onSizeChange:o.unref(Fe),onChange:r[9]||(r[9]=(n,i)=>{o.unref(h)(),u("page-change",n,i)}),onPrevClick:r[10]||(r[10]=n=>{u("prev-click",n)}),onNextClick:r[11]||(r[11]=n=>{u("next-click",n)})}),null,16,["total","onCurrentChange","onSizeChange"])],512)):t.createCommentVNode("",!0)],6)}}});exports.default=wt;
