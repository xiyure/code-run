"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const v=require("vue"),S=require("../../../utils/utils.cjs");require("../../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../../node_modules/culori/src/index.cjs");const E=require("../../../node_modules/lodash-es/cloneDeep.cjs");function I(k,H,i,y){const u=v.ref([]),g=v.ref([]),h=v.ref([]),p=v.ref([]);let C="";v.onMounted(()=>{A()});const o=v.computed(()=>{const{excludes:e=[]}=i.transferConfig??{};return new Set(e)});async function A(){var r;let e=i.defaultTransferData??[];typeof i.defaultTransferData=="function"&&(e=await((r=i.defaultTransferData)==null?void 0:r.call(i))),e=Array.isArray(e)?e:[];const n=new Map(e.map(t=>[t.key,t])),l=e.map(t=>t.key),a=i.column.map(t=>{var f,T;const d=t.field??`_table_column_${t.type??""}`,s=((f=n.get(d))==null?void 0:f.visible)??t.visible!==!1,c=(T=n.get(d))==null?void 0:T.width,w=t.editRender??(typeof t.renderEdit=="function"?{}:void 0);return{...E.default(t),visible:s,field:d,__width__:c,editRender:w}});y.value=S.sortBySmallerList(a,l,"field"),D(),M(e),setTimeout(()=>{C=JSON.stringify(b())})}function D(){u.value=S.treeDataToArray(y.value,"group"),h.value=u.value.map(e=>e.field&&!o.value.has(e.field)&&!o.value.has(e.type??"")?{label:e.title||e.type||"undefined",key:e.field,disabled:e.allowChangeVisible===!1}:null).filter(e=>e!==null),g.value=u.value.filter(e=>e.visible!==!1&&!o.value.has(e.field)&&!o.value.has(e.type??"")).map(e=>e.field).filter(e=>e!==void 0),p.value=[...g.value]}function _(e){if(!Array.isArray(e))return;let n=0;const l=new Map(u.value.map(r=>[r.field,r])),a=r=>{var t;for(const[d,s]of r.entries())if(Array.isArray(s.group)&&s.group.length>0)a(s.group);else{if(o.value.has(s.field)||o.value.has(s.type??""))continue;const c=(t=e[n++])==null?void 0:t.key;r[d]=l.get(c)??{}}};a(y.value),u.value=S.treeDataToArray(y.value,"group")}function q(){typeof i.onTransferShow=="function"&&i.onTransferShow()}function m(){if(typeof i.onTransferChange=="function"){const e=b();JSON.stringify(e)!==C&&(i.onTransferChange(e),C=JSON.stringify(e))}}function x(){if(typeof i.onTransferHide=="function"){const e=b();i.onTransferHide(e)}}function b(){var d,s,c,w;const e=new Map,n=(d=k.value)==null?void 0:d.getColumns();if(!n)return[];for(const f of n){const T=(s=k.value)==null?void 0:s.getColumnWidth(f);e.set(f.field,String(T))}const l=new Set(g.value),a=(w=(c=H.value)==null?void 0:c.transferRef)==null?void 0:w[0];return(a?a.getTransferData().sourceData:h.value).map(f=>({label:f.label,key:f.key,width:e.get(f.key)??"",visible:l.has(f.key),disabled:f.disabled??!1}))}function O(e){var n,l;(n=e.forEach)==null||n.call(e,a=>{const r=u.value.find(t=>t.field===a.key);r&&(a.visible?r.visible=!0:r.visible=!1)}),h.value=((l=e.map)==null?void 0:l.call(e,a=>({label:a.label??"",key:a.key??`_${S.genRandomStr(8)}`,disabled:a.disabled??!1,visible:a.visible!==!1})))??[],g.value=h.value.filter(a=>a.visible!==!1).map(a=>a.key),_(e),M(e)}function M(e){const n=new Map(e.map(l=>[l.key,l]));for(const l of y.value){const a=n.get(l.field);!a||!a.width||(l.width=a.width)}}function R(e){u.value.forEach(n=>{e.includes(n.field)||o.value.has(n.field)||o.value.has(n.type??"")?n.visible=!0:n.visible=!1})}return{flatColumns:u,selectData:g,originData:h,defaultHeader:p,updateTransfer:D,transferChange:m,transferHide:x,transferShow:q,sortTableHeader:_,updateColVisible:R,_transferMethods:{getHeaderControllerData:b,setHeaderControllerData:O}}}exports.useHeaderControl=I;
