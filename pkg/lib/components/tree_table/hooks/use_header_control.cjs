"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("../../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const T=require("../../../utils/utils.cjs");require("../../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../../node_modules/culori/src/index.cjs");const E=require("../../../node_modules/lodash-es/cloneDeep.cjs"),C=require("../../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),H=require("../../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs");function I(k,m,i,v){const u=C.ref([]),y=C.ref([]),g=C.ref([]),_=C.ref([]);let S="";H.onMounted(()=>{q()});const o=H.computed(()=>{const{excludes:e=[]}=i.transferConfig??{};return new Set(e)});async function q(){var l;let e=i.defaultTransferData??[];typeof i.defaultTransferData=="function"&&(e=await((l=i.defaultTransferData)==null?void 0:l.call(i))),e=Array.isArray(e)?e:[];const t=new Map(e.map(a=>[a.key,a])),r=e.map(a=>a.key),n=i.column.map(a=>{var s,w;const d=a.field??`_table_column_${a.type??""}`,f=((s=t.get(d))==null?void 0:s.visible)??a.visible!==!1,c=(w=t.get(d))==null?void 0:w.width,b=a.editRender??(typeof a.renderEdit=="function"?{}:void 0);return{...E.default(a),visible:f,field:d,__width__:c,editRender:b}});v.value=T.sortBySmallerList(n,r,"field"),p(),M(e),setTimeout(()=>{S=JSON.stringify(h())})}function p(){u.value=T.treeDataToArray(v.value,"group"),g.value=u.value.map(e=>e.field&&!o.value.has(e.field)&&!o.value.has(e.type??"")?{label:e.title||e.type||"undefined",key:e.field,disabled:e.allowChangeVisible===!1}:null).filter(e=>e!==null),y.value=u.value.filter(e=>e.visible!==!1&&!o.value.has(e.field)&&!o.value.has(e.type??"")).map(e=>e.field).filter(e=>e!==void 0),_.value=[...y.value]}function D(e){if(!Array.isArray(e))return;let t=0;const r=new Map(u.value.map(l=>[l.field,l])),n=l=>{var a;for(const[d,f]of l.entries())if(Array.isArray(f.group)&&f.group.length>0)n(f.group);else{if(o.value.has(f.field)||o.value.has(f.type??""))continue;const c=(a=e[t++])==null?void 0:a.key;l[d]=r.get(c)??{}}};n(v.value),u.value=T.treeDataToArray(v.value,"group")}function A(){typeof i.onTransferShow=="function"&&i.onTransferShow()}function x(){if(typeof i.onTransferChange=="function"){const e=h();JSON.stringify(e)!==S&&(i.onTransferChange(e),S=JSON.stringify(e))}}function O(){if(typeof i.onTransferHide=="function"){const e=h();i.onTransferHide(e)}}function h(){var d,f,c,b;const e=new Map,t=(d=k.value)==null?void 0:d.getColumns();if(!t)return[];for(const s of t){const w=(f=k.value)==null?void 0:f.getColumnWidth(s);e.set(s.field,String(w))}const r=new Set(y.value),n=(b=(c=m.value)==null?void 0:c.transferRef)==null?void 0:b[0];return(n?n.getTransferData().sourceData:g.value).map(s=>({label:s.label,key:s.key,width:e.get(s.key)??"",visible:r.has(s.key),disabled:s.disabled??!1}))}function R(e){var t,r;(t=e.forEach)==null||t.call(e,n=>{const l=u.value.find(a=>a.field===n.key);l&&(n.visible?l.visible=!0:l.visible=!1)}),g.value=((r=e.map)==null?void 0:r.call(e,n=>({label:n.label??"",key:n.key??`_${T.genRandomStr(8)}`,disabled:n.disabled??!1,visible:n.visible!==!1})))??[],y.value=g.value.filter(n=>n.visible!==!1).map(n=>n.key),D(e),M(e)}function M(e){const t=new Map(e.map(r=>[r.key,r]));for(const r of v.value){const n=t.get(r.field);!n||!n.width||(r.width=n.width)}}function B(e){u.value.forEach(t=>{e.includes(t.field)||o.value.has(t.field)||o.value.has(t.type??"")?t.visible=!0:t.visible=!1})}return{flatColumns:u,selectData:y,originData:g,defaultHeader:_,updateTransfer:p,transferChange:x,transferHide:O,transferShow:A,sortTableHeader:D,updateColVisible:B,_transferMethods:{getHeaderControllerData:h,setHeaderControllerData:R}}}exports.useHeaderControl=I;
