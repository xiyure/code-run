"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const C=require("vue"),L=require("../../../node_modules/@vue/shared/dist/shared.esm-bundler.cjs"),E=require("../../../node_modules/lodash-es/cloneDeep.cjs");function G(c,r,x,m,R){const O={},v=C.ref(new Set),k=new Set,P=C.computed(()=>v.value.size);let M=!1;const y=C.computed(()=>Object.assign(O,r.checkboxConfig||{})),S=C.computed(()=>{const e=()=>z(!0);if(L.isObject(r.batchOperateConfig)){const{showTotal:t=!0,total:n=v.value.size,data:i=[],checkMethod:s=e}=r.batchOperateConfig;return{showTotal:t,total:n,data:i,checkMethod:s}}return{showTotal:!0,total:v.value.size,data:r.batchOperations??[],checkMethod:e}}),u=C.computed(()=>{var e;return((e=r.rowConfig)==null?void 0:e.keyField)??"id"});C.onMounted(()=>{D()}),C.watch(()=>x.value.length,()=>{_()});async function D(){var s;if(!((s=x.value)!=null&&s.length)||M)return;await C.nextTick(),M=!0;const{checkRowKeys:e,checkAll:t}=y.value,n=Array.isArray(e)?e:[],i=t?x.value.filter(a=>a==null?void 0:a[u.value]):n.map(a=>{var o;return(o=R.tableDataMap.get(a))==null?void 0:o.node}).filter(a=>a);g(i,!0)}const B=(e,t)=>new Promise((n,i)=>{var o,l;c.value||(console.error("table instance not exists"),i(null));const s=Array.isArray(e)?e:[e],a=[];for(const f of s){if(b(f)||!(f!=null&&f[u.value]))continue;const h=(o=c.value)==null?void 0:o.getRowById(f[u.value]);a.push(h??f)}g(a,t),(l=c.value)==null||l.setCheckboxRow(a,t),n({rows:e,checked:t})}),F=e=>new Promise((t,n)=>{var s,a,o;c.value||(console.error("table instance not exists"),n(null));const i=[];if(e){for(const l of x.value){if(b(l)||!(l!=null&&l[u.value]))continue;const f=(s=c.value)==null?void 0:s.getRowById(l[u.value]);i.push(f??l)}g(i,e),(a=c.value)==null||a.setCheckboxRow(i,e)}else w(),(o=c.value)==null||o.setAllCheckboxRow(e);t({checked:e})}),g=(e,t)=>{const n=Array.isArray(e)?e:[e];for(const i of n)p(i,t)},p=(e,t)=>{if(!e||!(e!=null&&e[u.value]))return;b(e)||(t?v.value.add(e[u.value]):v.value.delete(e[u.value]));const n=R.tableDataMap.get(e[u.value]);if(!n||!n.children||n.children.length===0){if(b(e))return;t?k.add(e[u.value]):k.delete(e[u.value]);return}if(y.value.checkStrictly!==!0)for(const i of n.children)p(i,t)};async function I(){var t,n,i,s;if(!c.value||y.value.reserve===!1){w();return}if(await((t=c.value)==null?void 0:t.clearCheckboxRow()),await((n=c.value)==null?void 0:n.clearCheckboxReserve()),k.size===0)return;const e=[];for(const a of k.values()){const o=(i=c.value)==null?void 0:i.getRowById(a);o&&e.push(o)}(s=c.value)==null||s.setCheckboxRow(e,!0)}const A=()=>new Promise((e,t)=>{var n;c.value||(console.error("table instance not exists"),t(null)),r.showPage&&!r.useTree?g(m.value,!1):w(),(n=c.value)==null||n.clearCheckboxRow(),e(void 0)}),j=async()=>{var e;if(!c.value)return console.error("table instance not exists"),Promise.reject(null);await((e=c.value)==null?void 0:e.clearCheckboxReserve()),new Promise(t=>{var n,i;if(r.showPage&&!r.useTree){const s=(n=c.value)==null?void 0:n.getCheckboxRecords(!0);v.value=new Set(s.map(a=>a==null?void 0:a[u.value])),(i=c.value)==null||i.setCheckboxRow(s,!0)}t(void 0)})};function T({row:e,checked:t}){g(e,t)}function q({checked:e}){const t=m.value.filter(n=>!n.children||!n.children.length);g(t,e)}function K(){var e,t;A(),w(),(t=(e=c.value)==null?void 0:e.clearCheckboxReserve)==null||t.call(e)}function b(e){if(!c.value)return!1;const{visibleMethod:t,checkMethod:n}=y.value;return typeof t=="function"&&!t({$table:c.value,row:e})||typeof n=="function"&&!n({$table:c.value,row:e})}function w(){v.value.clear(),k.clear()}function _(){R.initTableMap();for(const e of k.keys())R.tableDataMap.has(e)||k.delete(e);for(const e of v.value.keys())R.tableDataMap.has(e)||v.value.delete(e)}function z(e=!1,t=!1){var i,s,a;if(!c.value)return console.error("table instance not exists"),[];if(!e)return(i=c.value)==null?void 0:i.getCheckboxRecords(!t);const n=E.default(k);if(r.useTree){const o=new Map,l=((s=r.treeConfig)==null?void 0:s.rowField)??"id",f=((a=r.treeConfig)==null?void 0:a.parentField)??"pid";for(const h of x.value)h[l]&&(o.has(h[l])||o.set(h[l],{id:h[l],pid:h[f],childrenSize:0,current:0}),o.has(h[f])&&o.get(h[f]).childrenSize++);for(const h of k.values()){let d=o.get(o.get(h).pid);for(d&&d.current++;d&&d.current===d.childrenSize;)n.add(d.id),d=o.get(d.pid),d&&d.current++}}return x.value.filter(o=>(o==null?void 0:o[u.value])&&n.has(o[u.value]))}return{_checkboxMethods:{setAllCheckboxRow:F,setCheckboxRow:B,clearCheckboxRow:A,clearCheckboxReserve:j,getCheckboxRecords:z},checkBoxChange:T,checkboxAllChange:q,closeBatchOperation:K,isCheckboxDisabled:b,clearCheckedData:w,initCheckedData:D,resetCheckboxStatus:I,checkedDataSize:P,checkboxConfig:y,batchOpConfig:S}}exports.useCheckbox=G;
