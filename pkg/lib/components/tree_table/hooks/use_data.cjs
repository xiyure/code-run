"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const g=require("vue"),G=require("../model/tree_store.cjs"),D=require("../../../constant/CN_dict.cjs"),Y=require("../const.cjs"),k=require("../../../utils/utils.cjs");require("../../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../../node_modules/culori/src/index.cjs");function B(N,n,y,z,_,A,T,O,R){const C=new G.default(n),r=g.ref(Y.DEFAULT_PAGE_CONFIG),q=g.computed(()=>M()?A.value:I()),x=g.computed(()=>!L.value||b()?q.value:K(q.value)),L=g.computed(()=>n.showPage&&!n.useTree&&!n.simple),E=g.computed(()=>{const{total:e}=r.value;return b()?e:q.value.length});g.watch(()=>n.paginationConfig,()=>{r.value={...r.value,size:n.useAntStyle?"sm":void 0,layout:n.useAntStyle?"total, ->, prev, pager, next, sizes":void 0,...n.paginationConfig||{}}},{immediate:!0,deep:!0}),g.watch([()=>T.value],async()=>{const{searchMethod:e}=n.searchConfig??{},t=S();if(M()){if(typeof n.requestMethod=="function")await P();else if(typeof e=="function"){const a=await e(t);R(Array.isArray(a)?a:[])}y("remote-query",t)}});function I(){const e=A.value;C.initTableData([..._.value]),C.initTableMap();const{strict:t,ignoreCase:a=!1,searchColumns:o}=n.searchConfig??{},l=T.value.trim();if(!l)return e;const u=z.value.filter(i=>i.visible!==!1),v=Array.isArray(o)?o:u.map(i=>i.field&&!i.type?i.field:null).filter(i=>i!==null);let h=e.filter(i=>v.some(d=>{var f,w;const m=((w=(f=N.value)==null?void 0:f.getCellLabel)==null?void 0:w.call(f,i,d))??i[d];if(t===!0)return m.toString()===l;const s=a?String(m).toLowerCase():String(m),c=a?l.toLowerCase():l;return s.indexOf(c)!==-1||Q(d,s,c,a)}));if(n.useTree){const{isEvery:i=!1}=n.searchConfig??{};h=C.handleTreeData(h,i)}else U(h.length);return h}function Q(e,t,a,o=!1){var d,m;const l=((d=n.searchConfig)==null?void 0:d.supportPinYin)??!1;if(l!==!0&&!(Array.isArray(l)&&l.includes(e)))return!1;let u="";const v=[],h=new RegExp(`${Object.keys(D.TONE_MARKS).join("|")}`,"g");for(let s=0;s<t.length;s++){const c=(m=D.CN_DICT[t[s]])==null?void 0:m.replace(h,w=>D.TONE_MARKS[w]);if(!c){u+=t[s];continue}const f=c.split(",");f.length>1?(u!=null&&u.length&&v.push([u]),v.push(f),u=""):u+=c}u.length&&v.push([u]);const i=k.getAllCombinations(v);for(const s of i)if((o?s.toLowerCase():s).indexOf(a)!==-1)return!0;return!1}function j(e){r.value.pageSize=e,b()&&(P(),y("server-paging",S())),y("page-size-change",e)}function F(e){r.value.currentPage=e,b()&&(P(),y("server-paging",S())),y("page-current-change",e)}function K(e){const{currentPage:t,pageSize:a}=r.value;if(!a||!t)return[];const o=(t-1)*a,l=o+a;return e.slice(o,l)}function U(e){let{currentPage:t,pageSize:a}=r.value;if(!(!t||!a)){for(;(t-1)*a+1>e&&t>1;)t--;r.value.currentPage=t}}function b(){const{isRemotePaging:e}=r.value,{isRemoteQuery:t}=n.searchConfig??{},{remote:a}=n.advancedFilterConfig??{};return e||n.isServerPaging||t||n.isRemoteQuery||a}function M(){var e;return n.isRemoteQuery||((e=n.searchConfig)==null?void 0:e.isRemoteQuery)}async function P(){const{total:e=0}=r.value,t=S();if(typeof n.requestMethod=="function"){const{data:a=[],total:o}=await n.requestMethod(t)??{};R(a),r.value.total=isNaN(Number(o))?e:Number(o)}}function S(){const{currentPage:e,pageSize:t,pageSizes:a}=r.value;return{currentPage:e,pageSize:t,pageSizes:a,searchKeyword:T.value.trim(),conditionInfo:O.value??{},currentData:A.value}}return{showTableData:x,dataLength:E,isPaging:L,paginationConfig:r,treeStore:C,changePageSize:j,changeCurrentPage:F,handleRemoteData:P}}exports.useData=B;
