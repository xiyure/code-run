"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("../../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const U=require("../model/tree_store.cjs"),D=require("../../../constant/CN_dict.cjs"),G=require("../const.cjs"),Y=require("../../../utils/utils.cjs");require("../../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../../node_modules/culori/src/index.cjs");const k=require("../../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),m=require("../../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs");function $(M,n,y,N,z,w,A,O,R){const C=new U.default(n),i=k.ref(G.DEFAULT_PAGE_CONFIG),T=m.computed(()=>L()?w.value:I()),x=m.computed(()=>!_.value||b()?T.value:F(T.value)),_=m.computed(()=>n.showPage&&!n.useTree&&!n.simple),E=m.computed(()=>{const{total:e}=i.value;return b()?e:T.value.length});m.watch(()=>n.paginationConfig,()=>{i.value={...i.value,size:n.useAntStyle?"sm":void 0,layout:n.useAntStyle?"total, ->, prev, pager, next, sizes":void 0,...n.paginationConfig||{}}},{immediate:!0,deep:!0}),m.watch([()=>A.value],async()=>{const{searchMethod:e}=n.searchConfig??{},t=S();if(L()){if(typeof n.requestMethod=="function")await P();else if(typeof e=="function"){const a=await e(t);R(Array.isArray(a)?a:[])}y("remote-query",t)}});function I(){const e=w.value;C.initTableData([...z.value]),C.initTableMap();const{strict:t,ignoreCase:a=!1,searchColumns:o}=n.searchConfig??{},l=A.value.trim();if(!l)return e;const u=N.value.filter(r=>r.visible!==!1),g=Array.isArray(o)?o:u.map(r=>r.field&&!r.type?r.field:null).filter(r=>r!==null);let v=e.filter(r=>g.some(h=>{var f,q;const d=((q=(f=M.value)==null?void 0:f.getCellLabel)==null?void 0:q.call(f,r,h))??r[h];if(t===!0)return d.toString()===l;const s=a?String(d).toLowerCase():String(d),c=a?l.toLowerCase():l;return s.indexOf(c)!==-1||Q(h,s,c,a)}));if(n.useTree){const{isEvery:r=!1}=n.searchConfig??{};v=C.handleTreeData(v,r)}else K(v.length);return v}function Q(e,t,a,o=!1){var h,d;const l=((h=n.searchConfig)==null?void 0:h.supportPinYin)??!1;if(l!==!0&&!(Array.isArray(l)&&l.includes(e)))return!1;let u="";const g=[],v=new RegExp(`${Object.keys(D.TONE_MARKS).join("|")}`,"g");for(let s=0;s<t.length;s++){const c=(d=D.CN_DICT[t[s]])==null?void 0:d.replace(v,q=>D.TONE_MARKS[q]);if(!c){u+=t[s];continue}const f=c.split(",");f.length>1?(u!=null&&u.length&&g.push([u]),g.push(f),u=""):u+=c}u.length&&g.push([u]);const r=Y.getAllCombinations(g);for(const s of r)if((o?s.toLowerCase():s).indexOf(a)!==-1)return!0;return!1}function j(e){i.value.pageSize=e,b()&&(P(),y("server-paging",S())),y("page-size-change",e)}function B(e){i.value.currentPage=e,b()&&(P(),y("server-paging",S())),y("page-current-change",e)}function F(e){const{currentPage:t,pageSize:a}=i.value;if(!a||!t)return[];const o=(t-1)*a,l=o+a;return e.slice(o,l)}function K(e){let{currentPage:t,pageSize:a}=i.value;if(!(!t||!a)){for(;(t-1)*a+1>e&&t>1;)t--;i.value.currentPage=t}}function b(){const{isRemotePaging:e}=i.value,{isRemoteQuery:t}=n.searchConfig??{},{remote:a}=n.advancedFilterConfig??{};return e||n.isServerPaging||t||n.isRemoteQuery||a}function L(){var e;return n.isRemoteQuery||((e=n.searchConfig)==null?void 0:e.isRemoteQuery)}async function P(){const{total:e=0}=i.value,t=S();if(typeof n.requestMethod=="function"){const{data:a=[],total:o}=await n.requestMethod(t)??{};R(a),i.value.total=isNaN(Number(o))?e:Number(o)}}function S(){const{currentPage:e,pageSize:t,pageSizes:a}=i.value;return{currentPage:e,pageSize:t,pageSizes:a,searchKeyword:A.value.trim(),conditionInfo:O.value??{},currentData:w.value}}return{showTableData:x,dataLength:E,isPaging:_,paginationConfig:i,treeStore:C,changePageSize:j,changeCurrentPage:B,handleRemoteData:P}}exports.useData=$;
