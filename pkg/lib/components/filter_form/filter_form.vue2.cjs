"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});require("../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const G=require("../input/index.cjs"),T=require("../select/index.cjs"),S=require("../radio/index.cjs"),V=require("../checkbox/index.cjs"),O=require("../date_picker/index.cjs"),z=require("../button/index.cjs"),q=require("../form/index.cjs"),j=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const Z=require("../../hooks/use_size.cjs"),J=require("../../hooks/use_locale.cjs"),e=require("../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs"),r=require("../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),x=require("../../node_modules/@vue/runtime-core/node_modules/@vue/shared/dist/shared.esm-bundler.cjs"),Q=require("../../node_modules/@vue/runtime-dom/dist/runtime-dom.esm-bundler.cjs"),W=e.defineComponent({name:"KFilterForm",__name:"filter_form",props:{items:{default:()=>[]},size:{},collapse:{type:Boolean,default:!0},reserve:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},showColon:{type:Boolean}},emits:["search","reset","change"],setup(b,{expose:E,emit:L}){const N=["base","sm"],d=b,U=Z.useSize(d),h=L,n=r.ref({});let w={};const u=r.ref(),s=r.ref(),i=r.ref(),a=r.ref(),g=r.ref(d.collapse),f=r.ref(1),B=r.ref(1),D=r.ref(""),{t:m}=J.useLocale();e.onMounted(()=>{if(!d.collapse){$();return}y(),a==null||a.value.style.setProperty("--transition-duration","0.3s"),a==null||a.value.classList.remove("is-expand"),i==null||i.value.classList.remove("is-expand")}),window.addEventListener("resize",y),e.onUnmounted(()=>{window.removeEventListener("resize",y)});const v=e.computed(()=>(t={})=>{const{size:c}=t;return c&&N.includes(c)?c:U.value.ownSize}),_=e.computed(()=>t=>{let c=t.visible??!0;if(typeof c=="function"&&(c=c(n.value)),c===!1&&t.prop&&!d.reserve){const o=d.items.find(l=>l.prop===t.prop);n.value[t.prop]=o==null?void 0:o.value}return c});e.watch(()=>d.items,()=>{w={}}),e.watch(()=>d.items,()=>{var t;(t=d.items)==null||t.forEach(c=>{const{prop:o,value:l}=c;l!==w[o]&&(n.value[o]=l,w[o]=l)})},{deep:!0,immediate:!0}),e.watch(()=>n.value,t=>{h("change",t),setTimeout(()=>{var p,k;const c=i.value.offsetTop;u==null||u.value.style.setProperty("--top-new",`${c}px`);const o=((p=s.value)==null?void 0:p.$el.clientHeight)??0;a==null||a.value.style.setProperty("--expandHeight",`${o}px`);const l=getComputedStyle((k=s==null?void 0:s.value)==null?void 0:k.$el).gridTemplateRows.split(" ");D.value=l[0],B.value=l.length,y()},100)},{deep:!0});function C(){u==null||u.value.classList.toggle("is-expand"),i==null||i.value.classList.toggle("is-expand"),a==null||a.value.classList.toggle("is-expand"),g.value=!g.value;const t=i.value.offsetTop;u==null||u.value.style.setProperty("--top-new",`${t}px`),setTimeout(()=>{var l;const c=((l=s.value)==null?void 0:l.$el.clientHeight)??0;a==null||a.value.style.setProperty("--expandHeight",`${c}px`);const o=i.value.offsetTop;u==null||u.value.style.setProperty("--top-new",`${o}px`)},1)}function $(){u==null||u.value.classList.add("is-expand"),s==null||s.value.$el.classList.add("is-expand"),g.value=!1}function H(){u==null||u.value.classList.remove("is-expand"),s==null||s.value.$el.classList.remove("is-expand"),g.value=!0}function A(){h("search",n.value)}function P(){d.items.forEach(t=>{n.value[t.prop]=t.value}),s.value.resetFields(),h("reset")}function I(){return n.value}function y(){var o,l;if(!((o=s==null?void 0:s.value)!=null&&o.$el))return;let t=1;const c=getComputedStyle((l=s==null?void 0:s.value)==null?void 0:l.$el).gridTemplateColumns.split(" ");for(let p=1;p<c.length;p++){if(Math.abs(parseInt(c[p])-parseInt(c[p-1]))>2){f.value=t;break}t++}f.value=t,setTimeout(()=>{M()},1)}function M(){var p,k;const t=((p=s.value)==null?void 0:p.$el.clientHeight)??0,c=i.value.offsetTop,o=getComputedStyle((k=s==null?void 0:s.value)==null?void 0:k.$el).gridTemplateRows.split(" "),l=o[0];B.value=o.length,a==null||a.value.style.setProperty("--expandHeight",`${t}px`),a==null||a.value.style.setProperty("--transition-duration","0.3s"),u==null||u.value.style.setProperty("--top-new",`${c}px`),a==null||a.value.style.setProperty("--firstRowHeight",`${l}`)}const K={reset:P,getFormData:I,toggle:C,expand:$,collapse:H};return E(j.getExposeProxy(K,s)),(t,c)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"filterForm",ref:a,class:"filterForm is-expand"},[e.createVNode(r.unref(q.KForm),{ref_key:"KFormRef",ref:s,class:"filter-items w-full relative grid grid-cols-1 2xs:grid-cols-2 xs:grid-cols-2 sm:grid-cols-3 base:grid-cols-4 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6",model:n.value,size:t.size,"show-colon":t.showColon},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.items,o=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:o.prop},[_.value(o)?(e.openBlock(),e.createBlock(r.unref(q.KFormItem),e.mergeProps({key:o.prop},o,{style:`grid-column: span ${o.column===void 0?1:o.column<f.value?o.column:f.value}`,class:"grid-auto-rows:max-content;"}),{default:e.withCtx(()=>[e.renderSlot(t.$slots,o.prop,{formData:n.value},()=>[typeof o.render=="function"?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(o.render(n.value)),{key:0})):o.type==="select"?(e.openBlock(),e.createBlock(r.unref(T.KSelect),e.mergeProps({key:1,modelValue:n.value[o.prop],"onUpdate:modelValue":l=>n.value[o.prop]=l},o.attrs,{size:v.value(o.attrs)}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.options,l=>(e.openBlock(),e.createBlock(r.unref(T.KOption),e.mergeProps(l,{key:l}),null,16))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","size"])):o.type==="radio"?(e.openBlock(),e.createBlock(r.unref(S.KRadioGroup),e.mergeProps({key:2,modelValue:n.value[o.prop],"onUpdate:modelValue":l=>n.value[o.prop]=l},o.attrs,{size:v.value(o.attrs)}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.options,l=>(e.openBlock(),e.createBlock(r.unref(S.KRadio),e.mergeProps(l,{key:l}),null,16))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","size"])):o.type==="checkbox"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:3},[Array.isArray(o.value)?(e.openBlock(),e.createBlock(r.unref(V.KCheckboxGroup),e.mergeProps({key:0,modelValue:n.value[o.prop],"onUpdate:modelValue":l=>n.value[o.prop]=l},o.attrs,{size:v.value(o.attrs)}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.options,l=>(e.openBlock(),e.createBlock(r.unref(V.KCheckbox),e.mergeProps(l,{key:l,size:v.value(o.attrs)}),null,16,["size"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","size"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(o.options,l=>(e.openBlock(),e.createBlock(r.unref(V.KCheckbox),e.mergeProps(l,{key:l,modelValue:n.value[o.prop],"onUpdate:modelValue":p=>n.value[o.prop]=p,size:v.value(o.attrs)}),null,16,["modelValue","onUpdate:modelValue","size"]))),128))],64)):o.type==="date"?(e.openBlock(),e.createBlock(r.unref(O.KDatePicker),e.mergeProps({key:4,modelValue:n.value[o.prop],"onUpdate:modelValue":l=>n.value[o.prop]=l},o.attrs,{size:v.value(o.attrs)}),null,16,["modelValue","onUpdate:modelValue","size"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:5},[_.value(o)?(e.openBlock(),e.createBlock(r.unref(G.KInput),e.mergeProps({key:0,modelValue:n.value[o.prop],"onUpdate:modelValue":l=>n.value[o.prop]=l},o.attrs,{size:v.value(o.attrs)}),null,16,["modelValue","onUpdate:modelValue","size"])):e.createCommentVNode("",!0)],64))],!0)]),_:2},1040,["style"])):e.createCommentVNode("",!0)],64))),128)),e.createElementVNode("div",{ref_key:"markers",ref:i,class:"markers flex w-full h-8 is-expand",style:x.normalizeStyle(`grid-column: ${f.value} / ${f.value+1}; `)},null,4),e.createElementVNode("div",{ref_key:"filterBtn",ref:u,class:"filter-btns flex bg-white"},[e.renderSlot(t.$slots,"action",{},()=>[e.createVNode(r.unref(z.KButton),{size:v.value(),onClick:P},{default:e.withCtx(()=>{var o;return[e.createTextVNode(x.toDisplayString((o=r.unref(m))==null?void 0:o("filterForm.reset")),1)]}),_:1},8,["size"]),e.createVNode(r.unref(z.KButton),{size:v.value(),main:"",onClick:A},{default:e.withCtx(()=>{var o;return[e.createTextVNode(x.toDisplayString((o=r.unref(m))==null?void 0:o("filterForm.query")),1)]}),_:1},8,["size"]),e.withDirectives(e.createVNode(r.unref(z.KButton),{text:"","icon-right":g.value?"IconArrowBottom":"IconArrowTop",onClick:C},{default:e.withCtx(()=>{var o,l;return[e.createTextVNode(x.toDisplayString(g.value?(o=r.unref(m))==null?void 0:o("filterForm.expand"):(l=r.unref(m))==null?void 0:l("filterForm.collapse")),1)]}),_:1},8,["icon-right"]),[[Q.vShow,B.value>1]])],!0)],512)]),_:3},8,["model","size","show-colon"])],512))}});exports.default=W;
