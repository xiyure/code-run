"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),M=require("../input/index.cjs"),_=require("../select/index.cjs"),P=require("../radio/index.cjs"),w=require("../checkbox/index.cjs"),K=require("../date_picker/index.cjs"),B=require("../button/index.cjs"),T=require("../form/index.cjs"),G=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const O=require("../../hooks/use_size.cjs"),j=require("../../hooks/use_locale.cjs"),Z=e.defineComponent({name:"KFilterForm",__name:"filter_form",props:{items:{default:()=>[]},size:{},collapse:{type:Boolean,default:!0},reserve:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},showColon:{type:Boolean}},emits:["search","reset","change"],setup(S,{expose:b,emit:E}){const L=["base","sm"],i=S,q=O.useSize(i),m=E,s=e.ref({});let x={};const n=e.ref(),r=e.ref(),p=e.ref(),a=e.ref(),v=e.ref(i.collapse),g=e.ref(1),h=e.ref(1),N=e.ref(""),{t:k}=j.useLocale();e.onMounted(()=>{if(!i.collapse){C();return}y(),a==null||a.value.style.setProperty("--transition-duration","0.3s"),a==null||a.value.classList.remove("is-expand"),p==null||p.value.classList.remove("is-expand")}),window.addEventListener("resize",y),e.onUnmounted(()=>{window.removeEventListener("resize",y)});const d=e.computed(()=>(t={})=>{const{size:u}=t;return u&&L.includes(u)?u:q.value.ownSize}),V=e.computed(()=>t=>{let u=t.visible??!0;if(typeof u=="function"&&(u=u(s.value)),u===!1&&t.prop&&!i.reserve){const o=i.items.find(l=>l.prop===t.prop);s.value[t.prop]=o==null?void 0:o.value}return u});e.watch(()=>i.items,()=>{x={}}),e.watch(()=>i.items,()=>{var t;(t=i.items)==null||t.forEach(u=>{const{prop:o,value:l}=u;l!==x[o]&&(s.value[o]=l,x[o]=l)})},{deep:!0,immediate:!0}),e.watch(()=>s.value,t=>{m("change",t),setTimeout(()=>{var c,f;const u=p.value.offsetTop;n==null||n.value.style.setProperty("--top-new",`${u}px`);const o=((c=r.value)==null?void 0:c.$el.clientHeight)??0;a==null||a.value.style.setProperty("--expandHeight",`${o}px`);const l=getComputedStyle((f=r==null?void 0:r.value)==null?void 0:f.$el).gridTemplateRows.split(" ");N.value=l[0],h.value=l.length,y()},100)},{deep:!0});function z(){n==null||n.value.classList.toggle("is-expand"),p==null||p.value.classList.toggle("is-expand"),a==null||a.value.classList.toggle("is-expand"),v.value=!v.value;const t=p.value.offsetTop;n==null||n.value.style.setProperty("--top-new",`${t}px`),setTimeout(()=>{var l;const u=((l=r.value)==null?void 0:l.$el.clientHeight)??0;a==null||a.value.style.setProperty("--expandHeight",`${u}px`);const o=p.value.offsetTop;n==null||n.value.style.setProperty("--top-new",`${o}px`)},1)}function C(){n==null||n.value.classList.add("is-expand"),r==null||r.value.$el.classList.add("is-expand"),v.value=!1}function U(){n==null||n.value.classList.remove("is-expand"),r==null||r.value.$el.classList.remove("is-expand"),v.value=!0}function D(){m("search",s.value)}function $(){i.items.forEach(t=>{s.value[t.prop]=t.value}),r.value.resetFields(),m("reset")}function H(){return s.value}function y(){var o,l;if(!((o=r==null?void 0:r.value)!=null&&o.$el))return;let t=1;const u=getComputedStyle((l=r==null?void 0:r.value)==null?void 0:l.$el).gridTemplateColumns.split(" ");for(let c=1;c<u.length;c++){if(Math.abs(parseInt(u[c])-parseInt(u[c-1]))>2){g.value=t;break}t++}g.value=t,setTimeout(()=>{A()},1)}function A(){var c,f;const t=((c=r.value)==null?void 0:c.$el.clientHeight)??0,u=p.value.offsetTop,o=getComputedStyle((f=r==null?void 0:r.value)==null?void 0:f.$el).gridTemplateRows.split(" "),l=o[0];h.value=o.length,a==null||a.value.style.setProperty("--expandHeight",`${t}px`),a==null||a.value.style.setProperty("--transition-duration","0.3s"),n==null||n.value.style.setProperty("--top-new",`${u}px`),a==null||a.value.style.setProperty("--firstRowHeight",`${l}`)}const I={reset:$,getFormData:H,toggle:z,expand:C,collapse:U};return b(G.getExposeProxy(I,r)),(t,u)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"filterForm",ref:a,class:"filterForm is-expand"},[e.createVNode(e.unref(T.KForm),{ref_key:"KFormRef",ref:r,class:"filter-items w-full relative grid grid-cols-1 2xs:grid-cols-2 xs:grid-cols-2 sm:grid-cols-3 base:grid-cols-4 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6",model:s.value,size:t.size,"show-colon":t.showColon},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.items,o=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:o.prop},[V.value(o)?(e.openBlock(),e.createBlock(e.unref(T.KFormItem),e.mergeProps({key:o.prop},o,{style:`grid-column: span ${o.column===void 0?1:o.column<g.value?o.column:g.value}`,class:"grid-auto-rows:max-content;"}),{default:e.withCtx(()=>[e.renderSlot(t.$slots,o.prop,{formData:s.value},()=>[typeof o.render=="function"?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(o.render(s.value)),{key:0})):o.type==="select"?(e.openBlock(),e.createBlock(e.unref(_.KSelect),e.mergeProps({key:1,modelValue:s.value[o.prop],"onUpdate:modelValue":l=>s.value[o.prop]=l},o.attrs,{size:d.value(o.attrs)}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.options,l=>(e.openBlock(),e.createBlock(e.unref(_.KOption),e.mergeProps(l,{key:l}),null,16))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","size"])):o.type==="radio"?(e.openBlock(),e.createBlock(e.unref(P.KRadioGroup),e.mergeProps({key:2,modelValue:s.value[o.prop],"onUpdate:modelValue":l=>s.value[o.prop]=l},o.attrs,{size:d.value(o.attrs)}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.options,l=>(e.openBlock(),e.createBlock(e.unref(P.KRadio),e.mergeProps(l,{key:l}),null,16))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","size"])):o.type==="checkbox"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:3},[Array.isArray(o.value)?(e.openBlock(),e.createBlock(e.unref(w.KCheckboxGroup),e.mergeProps({key:0,modelValue:s.value[o.prop],"onUpdate:modelValue":l=>s.value[o.prop]=l},o.attrs,{size:d.value(o.attrs)}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.options,l=>(e.openBlock(),e.createBlock(e.unref(w.KCheckbox),e.mergeProps(l,{key:l,size:d.value(o.attrs)}),null,16,["size"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","size"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(o.options,l=>(e.openBlock(),e.createBlock(e.unref(w.KCheckbox),e.mergeProps(l,{key:l,modelValue:s.value[o.prop],"onUpdate:modelValue":c=>s.value[o.prop]=c,size:d.value(o.attrs)}),null,16,["modelValue","onUpdate:modelValue","size"]))),128))],64)):o.type==="date"?(e.openBlock(),e.createBlock(e.unref(K.KDatePicker),e.mergeProps({key:4,modelValue:s.value[o.prop],"onUpdate:modelValue":l=>s.value[o.prop]=l},o.attrs,{size:d.value(o.attrs)}),null,16,["modelValue","onUpdate:modelValue","size"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:5},[V.value(o)?(e.openBlock(),e.createBlock(e.unref(M.KInput),e.mergeProps({key:0,modelValue:s.value[o.prop],"onUpdate:modelValue":l=>s.value[o.prop]=l},o.attrs,{size:d.value(o.attrs)}),null,16,["modelValue","onUpdate:modelValue","size"])):e.createCommentVNode("",!0)],64))],!0)]),_:2},1040,["style"])):e.createCommentVNode("",!0)],64))),128)),e.createElementVNode("div",{ref_key:"markers",ref:p,class:"markers flex w-full h-8 is-expand",style:e.normalizeStyle(`grid-column: ${g.value} / ${g.value+1}; `)},null,4),e.createElementVNode("div",{ref_key:"filterBtn",ref:n,class:"filter-btns flex bg-white"},[e.renderSlot(t.$slots,"action",{},()=>[e.createVNode(e.unref(B.KButton),{size:d.value(),onClick:$},{default:e.withCtx(()=>{var o;return[e.createTextVNode(e.toDisplayString((o=e.unref(k))==null?void 0:o("filterForm.reset")),1)]}),_:1},8,["size"]),e.createVNode(e.unref(B.KButton),{size:d.value(),main:"",onClick:D},{default:e.withCtx(()=>{var o;return[e.createTextVNode(e.toDisplayString((o=e.unref(k))==null?void 0:o("filterForm.query")),1)]}),_:1},8,["size"]),e.withDirectives(e.createVNode(e.unref(B.KButton),{text:"","icon-right":v.value?"IconArrowBottom":"IconArrowTop",onClick:z},{default:e.withCtx(()=>{var o,l;return[e.createTextVNode(e.toDisplayString(v.value?(o=e.unref(k))==null?void 0:o("filterForm.expand"):(l=e.unref(k))==null?void 0:l("filterForm.collapse")),1)]}),_:1},8,["icon-right"]),[[e.vShow,h.value>1]])],!0)],512)]),_:3},8,["model","size","show-colon"])],512))}});exports.default=Z;
