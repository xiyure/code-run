"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});require("../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const D=require("../../utils/constructor/sortable.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/culori/src/index.cjs");const L=require("../../utils/dom.cjs"),T=require("./view_item.vue.cjs");;/* empty css                 */const ee=require("../../hooks/use_locale.cjs"),oe=require("../../hooks/use_deprecated.cjs"),le=require("./hooks/use_resize.cjs"),K=require("../tree/index.cjs"),M=require("./const.cjs"),te=require("../../node_modules/ksw-vue-icon/es/icons/base/left.cjs"),ae=require("../../node_modules/ksw-vue-icon/es/icons/base/reload.cjs"),ne=require("../../node_modules/element-plus/es/components/scrollbar/index.cjs"),e=require("../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs"),r=require("../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),d=require("../../node_modules/@vue/runtime-core/node_modules/@vue/shared/dist/shared.esm-bundler.cjs"),re={class:"k-view-aside"},se={key:0,class:"k-view__header"},ie={class:"k-view-title text-base font-bold"},ue={class:"k-view__special-data"},de={key:0,class:"k-view__custom text-base"},ce={class:"k-view__custom-default-title"},me={class:"k-view__custom-data"},ve={key:0,class:"k-view-content"},pe=e.defineComponent({name:"KView",__name:"view",props:{modelValue:{},defaultActive:{},data:{},draggable:{type:Boolean,default:!1},collapse:{type:Boolean,default:!1},showCustomControl:{type:Boolean,default:!1},useTree:{type:Boolean,default:!1},treeConfig:{},showArrow:{type:Boolean,default:!1},showCount:{type:Boolean,default:!0},props:{},simple:{type:Boolean,default:!1},height:{},defaultWidth:{default:250},minWidth:{default:0},maxWidth:{default:9999},resizeLineStyle:{},resizeLineClass:{},previewLineStyle:{},previewLineClass:{},iconMethod:{}},emits:["update:modelValue","refresh","change","remove","drag","visible-change","node-expand","node-collapse"],setup(R,{expose:O,emit:I}){const{t:E}=ee.useLocale(),W={label:"label",value:"value",count:"count",children:"children",disabled:"disabled",custom:"custom"},n=R;oe.useDeprecated({scope:"k-view",from:"show-arrow",replacement:"treeConfig.showArrow",version:"2.0.0"},e.computed(()=>!!n.showArrow));const c=I,i=r.ref(""),b=r.ref(),a=e.computed(()=>Object.assign(W,n.props??{})),F=e.computed(()=>{var o;return((o=n.data)==null?void 0:o.filter(l=>!l[a.value.custom]))??[]}),S=e.computed(()=>{var o;return(o=n.data)==null?void 0:o.filter(l=>!!l[a.value.custom])}),V=e.computed(()=>{const{emptyText:o,expandOnClickNode:l,checkOnClickNode:s,defaultExpandedKeys:t,accordion:m,indent:g,lazy:w,load:y,icon:C,expandIcon:B,collapseIcon:p,showArrow:x}=n.treeConfig??{};return{emptyText:o,expandOnClickNode:l,checkOnClickNode:s,defaultExpandedKeys:[i.value??"",...t??[]],accordion:m,indent:g,lazy:w,load:y,icon:C,expandIcon:B,collapseIcon:p,showArrow:x??n.showArrow,iconMethod:n.iconMethod}}),{containerWidth:v,previewPosition:j,isDragging:U,startDrag:N,toggleAsidePanel:_,showAsidePanel:Y,hideAsidePanel:G}=le.useResize(n,e.computed(()=>n.collapse));e.onMounted(()=>{J(),n.modelValue===void 0&&(i.value=n.defaultActive??"")}),e.onBeforeUnmount(()=>{var o,l;(o=h.common)==null||o.destroy(),(l=h.custom)==null||l.destroy()}),e.watch(()=>n.modelValue,o=>{o!==i.value&&(i.value=o)},{immediate:!0});function H(){c("refresh")}function f(o,l){i.value=o[a.value.value],c("update:modelValue",i.value),c("change",{value:i.value,data:o,node:l})}function q(o){c("remove",{value:o[a.value.value],data:o})}function $(o,l){A(l)||c("node-expand",o,l)}function z(o,l){A(l)||c("node-collapse",o,l)}function A(o){return o.isLeaf}const h={common:null,custom:null};let u=null;function J(){if(!n.draggable)return;const o=L.getElement(".k-view__special-data",b.value),l=L.getElement(".k-view__custom-data",b.value);o&&(h.common=D.Sortable(o,{handle:".k-view-common",animation:150,onMove:s=>{u=s.related},onEnd:k})),l&&(h.custom=D.Sortable(l,{handle:".k-view-custom",animation:150,onMove:s=>{u=s.related},onEnd:k}))}function k(o,l,s){var m,g;const t={targetNode:o,lastOverNode:l,position:s};if(!n.useTree){if(!u||u===o)return;const{item:w}=o,y=w.compareDocumentPosition(u);y===2?t.position="after":y===4&&(t.position="before");const C=u==null?void 0:u.getAttribute("data-view-value");t.lastOverNode=(m=n.data)==null?void 0:m.find(p=>p[a.value.value]===C);const B=w.getAttribute("data-view-value");t.targetNode=(g=n.data)==null?void 0:g.find(p=>p[a.value.value]===B),u=null}c("drag",t)}function Q(){return v.value>0}function X(){return v.value<=0}function Z(){return i.value}function P(o){return{label:o[a.value.label]??"",value:o[a.value.value]??"",count:o[a.value.count]??0,disabled:o[a.value.disabled]??!1,custom:o[a.value.custom]??!1,showCustomControl:o.showCustomControl??n.showCustomControl??!1}}return e.provide(M.ACTIVE_VIEW_KEY,i),e.provide(M.P_PROPS_KEY,n),O({expand:Y,collapse:G,toggle:_,isExpand:Q,isCollapse:X,getCurrentView:Z}),(o,l)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"KViewRef",ref:b,class:"k-view text-base",style:d.normalizeStyle({height:typeof o.height=="number"?`${o.height}px`:o.height})},[e.createElementVNode("div",{class:d.normalizeClass(["k-view-nav relative h-full flex-shrink-0 border-gray-200",{"is-collapse":r.unref(v)===0,"is-simple":o.simple,"border-r":!o.simple,"p-2":!o.simple,"pr-2":o.simple,"is-hide":r.unref(v)===0}]),style:d.normalizeStyle({width:`${r.unref(v)}px`})},[o.simple?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:"show-view-button flex items-center justify-center rounded-full",onClick:l[0]||(l[0]=()=>{r.unref(_)(),c("visible-change",r.unref(v)>0)})},[e.createVNode(r.unref(te.default))])),e.createElementVNode("div",re,[o.simple?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",se,[e.createElementVNode("div",ie,[e.renderSlot(o.$slots,"header",{},()=>{var s;return[e.createTextVNode(d.toDisplayString((s=r.unref(E))==null?void 0:s("view.view")),1)]})]),e.createElementVNode("span",{class:"view-fresh",onClick:H},[e.renderSlot(o.$slots,"refresh",{},()=>[e.createVNode(r.unref(ae.default))])])])),e.createVNode(r.unref(ne.ElScrollbar),null,{default:e.withCtx(()=>{var s;return[e.createElementVNode("div",ue,[o.useTree?(e.openBlock(),e.createBlock(r.unref(K.KTree),e.mergeProps({key:1,ref:"KViewTree",class:"k-tree-view-item","node-key":a.value.value,props:{label:a.value.label,disabled:a.value.disabled,children:a.value.children},"current-node-key":i.value,data:o.data,draggable:o.draggable,"highlight-current":""},V.value,{onCurrentChange:f,onNodeExpand:$,onNodeCollapse:z,onNodeDrop:k}),e.createSlots({_:2},[o.$slots.label?{name:"default",fn:e.withCtx(({node:t,data:m})=>[e.renderSlot(o.$slots,"label",{node:t,data:m})]),key:"0"}:void 0]),1040,["node-key","props","current-node-key","data","draggable"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(F.value,t=>(e.openBlock(),e.createBlock(T.default,e.mergeProps({key:t[a.value.value],"origin-data":t},P(t),{onChange:f,onRemove:q}),e.createSlots({_:2},[o.$slots.label?{name:"label",fn:e.withCtx(()=>[e.renderSlot(o.$slots,"label",{data:t})]),key:"0"}:void 0]),1040,["origin-data"]))),128))]),(s=S.value)!=null&&s.length?(e.openBlock(),e.createElementBlock("div",de,[e.renderSlot(o.$slots,"custom-header",{},()=>{var t;return[e.createElementVNode("span",ce,d.toDisplayString((t=r.unref(E))==null?void 0:t("view.customView")),1)]}),e.createElementVNode("div",me,[o.useTree?(e.openBlock(),e.createBlock(r.unref(K.KTree),e.mergeProps({key:1,ref:"KCustomViewTree",class:"k-tree-view-item","node-key":a.value.value,props:{label:a.value.label,disabled:a.value.disabled,children:a.value.children},"current-node-key":i.value,data:o.data,draggable:o.draggable,"highlight-current":""},V.value,{onCurrentChange:f,onNodeExpand:$,onNodeCollapse:z,onNodeDrop:k}),e.createSlots({_:2},[o.$slots.label?{name:"default",fn:e.withCtx(({node:t,data:m})=>[e.renderSlot(o.$slots,"label",{node:t,data:m})]),key:"0"}:void 0]),1040,["node-key","props","current-node-key","data","draggable"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(S.value,t=>(e.openBlock(),e.createBlock(T.default,e.mergeProps({key:t[a.value.value],"origin-data":t},P(t),{onChange:f,onRemove:q}),e.createSlots({_:2},[o.$slots.label?{name:"label",fn:e.withCtx(()=>[e.renderSlot(o.$slots,"label",{data:t})]),key:"0"}:void 0]),1040,["origin-data"]))),128))])])):e.createCommentVNode("",!0)]}),_:3})]),o.simple?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:1,class:d.normalizeClass(["k-view-resizer",o.resizeLineClass]),style:d.normalizeStyle(o.resizeLineStyle),onMousedown:l[1]||(l[1]=(...s)=>r.unref(N)&&r.unref(N)(...s))},null,38)),!o.simple&&r.unref(U)?(e.openBlock(),e.createElementBlock("div",{key:2,class:d.normalizeClass(["k-view-preview",o.previewLineClass]),style:d.normalizeStyle({left:r.unref(j)+"px",...o.previewLineStyle??{}})},null,6)):e.createCommentVNode("",!0)],6),o.simple?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",ve,[e.renderSlot(o.$slots,"default"),e.renderSlot(o.$slots,i.value)]))],4))}});exports.default=pe;
