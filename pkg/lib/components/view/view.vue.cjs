"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),A=require("../../utils/constructor/sortable.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/culori/src/index.cjs");const P=require("../../utils/dom.cjs"),D=require("./view_item.vue.cjs");;/* empty css                 */const Z=require("../../hooks/use_locale.cjs"),x=require("../../hooks/use_deprecated.cjs"),ee=require("./hooks/use_resize.cjs"),L=require("../tree/index.cjs"),T=require("./const.cjs"),oe=require("../../node_modules/ksw-vue-icon/es/icons/base/left.cjs"),le=require("../../node_modules/ksw-vue-icon/es/icons/base/reload.cjs"),te=require("../../node_modules/element-plus/es/components/scrollbar/index.cjs"),ae={class:"k-view-aside"},ne={key:0,class:"k-view__header"},re={class:"k-view-title text-base font-bold"},se={class:"k-view__special-data"},ie={key:0,class:"k-view__custom text-base"},ue={class:"k-view__custom-default-title"},de={class:"k-view__custom-data"},ce={key:0,class:"k-view-content"},ve=e.defineComponent({name:"KView",__name:"view",props:{modelValue:{},defaultActive:{},data:{},draggable:{type:Boolean,default:!1},collapse:{type:Boolean,default:!1},showCustomControl:{type:Boolean,default:!1},useTree:{type:Boolean,default:!1},treeConfig:{},showArrow:{type:Boolean,default:!1},showCount:{type:Boolean,default:!0},props:{},simple:{type:Boolean,default:!1},height:{},defaultWidth:{default:250},minWidth:{default:0},maxWidth:{default:9999},resizeLineStyle:{},resizeLineClass:{},previewLineStyle:{},previewLineClass:{},iconMethod:{}},emits:["update:modelValue","refresh","change","remove","drag","visible-change","node-expand","node-collapse"],setup(K,{expose:M,emit:R}){const{t:C}=Z.useLocale(),O={label:"label",value:"value",count:"count",children:"children",disabled:"disabled",custom:"custom"},n=K;x.useDeprecated({scope:"k-view",from:"show-arrow",replacement:"treeConfig.showArrow",version:"2.0.0"},e.computed(()=>!!n.showArrow));const u=R,s=e.ref(""),w=e.ref(),a=e.computed(()=>Object.assign(O,n.props??{})),I=e.computed(()=>{var o;return((o=n.data)==null?void 0:o.filter(l=>!l[a.value.custom]))??[]}),E=e.computed(()=>{var o;return(o=n.data)==null?void 0:o.filter(l=>!!l[a.value.custom])}),B=e.computed(()=>{const{emptyText:o,expandOnClickNode:l,checkOnClickNode:r,defaultExpandedKeys:t,accordion:d,indent:h,lazy:k,load:g,icon:y,expandIcon:b,collapseIcon:v,showArrow:X}=n.treeConfig??{};return{emptyText:o,expandOnClickNode:l,checkOnClickNode:r,defaultExpandedKeys:[s.value??"",...t??[]],accordion:d,indent:h,lazy:k,load:g,icon:y,expandIcon:b,collapseIcon:v,showArrow:X??n.showArrow,iconMethod:n.iconMethod}}),{containerWidth:c,previewPosition:W,isDragging:F,startDrag:S,toggleAsidePanel:V,showAsidePanel:j,hideAsidePanel:U}=ee.useResize(n,e.computed(()=>n.collapse));e.onMounted(()=>{G(),n.modelValue===void 0&&(s.value=n.defaultActive??"")}),e.onBeforeUnmount(()=>{var o,l;(o=p.common)==null||o.destroy(),(l=p.custom)==null||l.destroy()}),e.watch(()=>n.modelValue,o=>{o!==s.value&&(s.value=o)},{immediate:!0});function Y(){u("refresh")}function m(o,l){s.value=o[a.value.value],u("update:modelValue",s.value),u("change",{value:s.value,data:o,node:l})}function N(o){u("remove",{value:o[a.value.value],data:o})}function _(o,l){q(l)||u("node-expand",o,l)}function $(o,l){q(l)||u("node-collapse",o,l)}function q(o){return o.isLeaf}const p={common:null,custom:null};let i=null;function G(){if(!n.draggable)return;const o=P.getElement(".k-view__special-data",w.value),l=P.getElement(".k-view__custom-data",w.value);o&&(p.common=A.Sortable(o,{handle:".k-view-common",animation:150,onMove:r=>{i=r.related},onEnd:f})),l&&(p.custom=A.Sortable(l,{handle:".k-view-custom",animation:150,onMove:r=>{i=r.related},onEnd:f}))}function f(o,l,r){var d,h;const t={targetNode:o,lastOverNode:l,position:r};if(!n.useTree){if(!i||i===o)return;const{item:k}=o,g=k.compareDocumentPosition(i);g===2?t.position="after":g===4&&(t.position="before");const y=i==null?void 0:i.getAttribute("data-view-value");t.lastOverNode=(d=n.data)==null?void 0:d.find(v=>v[a.value.value]===y);const b=k.getAttribute("data-view-value");t.targetNode=(h=n.data)==null?void 0:h.find(v=>v[a.value.value]===b),i=null}u("drag",t)}function H(){return c.value>0}function J(){return c.value<=0}function Q(){return s.value}function z(o){return{label:o[a.value.label]??"",value:o[a.value.value]??"",count:o[a.value.count]??0,disabled:o[a.value.disabled]??!1,custom:o[a.value.custom]??!1,showCustomControl:o.showCustomControl??n.showCustomControl??!1}}return e.provide(T.ACTIVE_VIEW_KEY,s),e.provide(T.P_PROPS_KEY,n),M({expand:j,collapse:U,toggle:V,isExpand:H,isCollapse:J,getCurrentView:Q}),(o,l)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"KViewRef",ref:w,class:"k-view text-base",style:e.normalizeStyle({height:typeof o.height=="number"?`${o.height}px`:o.height})},[e.createElementVNode("div",{class:e.normalizeClass(["k-view-nav relative h-full flex-shrink-0 border-gray-200",{"is-collapse":e.unref(c)===0,"is-simple":o.simple,"border-r":!o.simple,"p-2":!o.simple,"pr-2":o.simple,"is-hide":e.unref(c)===0}]),style:e.normalizeStyle({width:`${e.unref(c)}px`})},[o.simple?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:"show-view-button flex items-center justify-center rounded-full",onClick:l[0]||(l[0]=()=>{e.unref(V)(),u("visible-change",e.unref(c)>0)})},[e.createVNode(e.unref(oe.default))])),e.createElementVNode("div",ae,[o.simple?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",ne,[e.createElementVNode("div",re,[e.renderSlot(o.$slots,"header",{},()=>{var r;return[e.createTextVNode(e.toDisplayString((r=e.unref(C))==null?void 0:r("view.view")),1)]})]),e.createElementVNode("span",{class:"view-fresh",onClick:Y},[e.renderSlot(o.$slots,"refresh",{},()=>[e.createVNode(e.unref(le.default))])])])),e.createVNode(e.unref(te.ElScrollbar),null,{default:e.withCtx(()=>{var r;return[e.createElementVNode("div",se,[o.useTree?(e.openBlock(),e.createBlock(e.unref(L.KTree),e.mergeProps({key:1,ref:"KViewTree",class:"k-tree-view-item","node-key":a.value.value,props:{label:a.value.label,disabled:a.value.disabled,children:a.value.children},"current-node-key":s.value,data:o.data,draggable:o.draggable,"highlight-current":""},B.value,{onCurrentChange:m,onNodeExpand:_,onNodeCollapse:$,onNodeDrop:f}),e.createSlots({_:2},[o.$slots.label?{name:"default",fn:e.withCtx(({node:t,data:d})=>[e.renderSlot(o.$slots,"label",{node:t,data:d})]),key:"0"}:void 0]),1040,["node-key","props","current-node-key","data","draggable"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(I.value,t=>(e.openBlock(),e.createBlock(D.default,e.mergeProps({key:t[a.value.value],"origin-data":t},z(t),{onChange:m,onRemove:N}),e.createSlots({_:2},[o.$slots.label?{name:"label",fn:e.withCtx(()=>[e.renderSlot(o.$slots,"label",{data:t})]),key:"0"}:void 0]),1040,["origin-data"]))),128))]),(r=E.value)!=null&&r.length?(e.openBlock(),e.createElementBlock("div",ie,[e.renderSlot(o.$slots,"custom-header",{},()=>{var t;return[e.createElementVNode("span",ue,e.toDisplayString((t=e.unref(C))==null?void 0:t("view.customView")),1)]}),e.createElementVNode("div",de,[o.useTree?(e.openBlock(),e.createBlock(e.unref(L.KTree),e.mergeProps({key:1,ref:"KCustomViewTree",class:"k-tree-view-item","node-key":a.value.value,props:{label:a.value.label,disabled:a.value.disabled,children:a.value.children},"current-node-key":s.value,data:o.data,draggable:o.draggable,"highlight-current":""},B.value,{onCurrentChange:m,onNodeExpand:_,onNodeCollapse:$,onNodeDrop:f}),e.createSlots({_:2},[o.$slots.label?{name:"default",fn:e.withCtx(({node:t,data:d})=>[e.renderSlot(o.$slots,"label",{node:t,data:d})]),key:"0"}:void 0]),1040,["node-key","props","current-node-key","data","draggable"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(E.value,t=>(e.openBlock(),e.createBlock(D.default,e.mergeProps({key:t[a.value.value],"origin-data":t},z(t),{onChange:m,onRemove:N}),e.createSlots({_:2},[o.$slots.label?{name:"label",fn:e.withCtx(()=>[e.renderSlot(o.$slots,"label",{data:t})]),key:"0"}:void 0]),1040,["origin-data"]))),128))])])):e.createCommentVNode("",!0)]}),_:3})]),o.simple?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(["k-view-resizer",o.resizeLineClass]),style:e.normalizeStyle(o.resizeLineStyle),onMousedown:l[1]||(l[1]=(...r)=>e.unref(S)&&e.unref(S)(...r))},null,38)),!o.simple&&e.unref(F)?(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass(["k-view-preview",o.previewLineClass]),style:e.normalizeStyle({left:e.unref(W)+"px",...o.previewLineStyle??{}})},null,6)):e.createCommentVNode("",!0)],6),o.simple?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",ce,[e.renderSlot(o.$slots,"default"),e.renderSlot(o.$slots,s.value)]))],4))}});exports.default=ve;
