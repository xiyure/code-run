"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),K=require("../popover/index.cjs"),S=require("../checkbox/index.cjs"),x=require("../button/index.cjs"),T=require("../../hooks/use_locale.cjs"),_={key:0,class:"filter-menu"},O={class:"filter-menu-item"},R=["onClick"],U={key:2,class:"filter-buttons"},j=e.defineComponent({__name:"filter_popper",props:{filters:{default:()=>[]},column:{default:()=>({})},trigger:{default:"hover"},visible:{type:Boolean,default:void 0},text:{default:()=>({})},teleported:{type:Boolean,default:!1},destroyOnClose:{type:Boolean,default:!1},filterMultiple:{type:Boolean,default:!0}},emits:["set-filter","clear-filter","filter-visible","close-filter-panel"],setup(F,{expose:N,emit:A}){const i=F,{t:f}=T.useLocale(),d=A,p=e.ref(),u=e.ref(!1),s=e.ref(!1),m=e.ref(!1),a=e.ref([]);let C="[]";const k=e.computed(()=>{var l;return((l=i.filters.find(t=>t.checked))==null?void 0:l.value)??null});e.watch(()=>i.filters,l=>{a.value=Array.isArray(l)?l:[],v(),c()},{immediate:!0});function g(l){var t;d("filter-visible",{column:i.column,field:(t=i.column)==null?void 0:t.field,visible:l,filterList:a.value})}function w(){m.value=!0}function L(){i.destroyOnClose&&(m.value=!1)}function v(){var t,n;if(!Array.isArray(a.value)){u.value=!1;return}u.value=(t=a.value)==null?void 0:t.every(o=>o.checked);const l=(n=a.value)==null?void 0:n.some(o=>o.checked);!u.value&&l?s.value=!0:s.value=!1}function P(){var l;u.value&&s.value&&(s.value=!1),(l=a.value)==null||l.forEach(t=>{t.checked=u.value})}function M(l,t){k.value!==t.value&&(V(),t.checked=!0,y(l))}function y(l){const{hasChange:t,values:n}=c();t&&d("set-filter",{column:i.column,field:i.column.field,filterList:a.value,values:n,$event:l})}function B(l){a.value.forEach(n=>{n.checked=!1}),s.value=!1,u.value=!1;const{hasChange:t}=c();t&&d("clear-filter",{filterList:a.value,$event:l})}function $(){var l;if(i.visible===void 0){(l=p.value)==null||l.hide();return}d("close-filter-panel")}function c(){const l=a.value.filter(o=>o.checked).map(o=>o.value),t=JSON.stringify(l),n=C!==t;return n&&(C=t),{hasChange:n,values:l}}function q(l){a.value=Array.isArray(l)?l:[],v(),c()}function V(){a.value.forEach(l=>{l.checked=!1}),v(),c()}function z(){}function D(){}return N({popperRef:e.computed(()=>{var l,t;return(t=(l=p.value)==null?void 0:l.popperRef)==null?void 0:t.contentRef}),setFilter:q,clearFilter:V,resetFilterPanel:z,saveFilterPanel:D,closeFilterPanel:$}),(l,t)=>{var n;return e.openBlock(),e.createBlock(e.unref(K.KPopover),{ref_key:"filterPopper",ref:p,trigger:l.trigger,"show-arrow":!1,placement:"right-start","popper-class":"filter-box",offset:2,disabled:!((n=a.value)!=null&&n.length),teleported:!0,visible:l.visible,onShow:t[2]||(t[2]=()=>{g(!0)}),onHide:t[3]||(t[3]=()=>{g(!1)}),onBeforeEnter:w,onAfterLeave:L},{reference:e.withCtx(()=>[e.renderSlot(l.$slots,"default",{disabled:!a.value.length})]),default:e.withCtx(()=>[m.value?e.renderSlot(l.$slots,"filter",{key:0},()=>{var o,E;return[l.filterMultiple?(e.openBlock(),e.createElementBlock("ul",_,[e.createElementVNode("li",O,[e.createVNode(e.unref(S.KCheckbox),{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=r=>u.value=r),label:(o=e.unref(f))==null?void 0:o("table.all"),value:"all",indeterminate:s.value,onChange:P},null,8,["modelValue","label","indeterminate"])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,(r,h)=>(e.openBlock(),e.createElementBlock("li",{key:h,class:"filter-menu-item"},[e.createVNode(e.unref(S.KCheckbox),{modelValue:r.checked,"onUpdate:modelValue":b=>r.checked=b,label:r.label,value:r.value,onChange:v},null,8,["modelValue","onUpdate:modelValue","label","value"])]))),128))])):(e.openBlock(),e.createElementBlock("ul",{key:1,class:e.normalizeClass(["filter-menu",{"filter-multiple-disabled":!l.filterMultiple}])},[e.createElementVNode("li",{class:e.normalizeClass(["filter-menu-item",{"is-active":k.value===null}]),onClick:t[1]||(t[1]=r=>{B(r)})},e.toDisplayString((E=e.unref(f))==null?void 0:E("table.all")),3),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,(r,h)=>(e.openBlock(),e.createElementBlock("li",{key:h,class:e.normalizeClass(["filter-menu-item",{"is-active":k.value===r.value}]),onClick:b=>{M(b,r)}},e.toDisplayString(r.label),11,R))),128))],2)),l.filterMultiple?(e.openBlock(),e.createElementBlock("div",U,[e.createVNode(e.unref(x.KButton),{size:"sm",onClick:B},{default:e.withCtx(()=>{var r;return[e.createTextVNode(e.toDisplayString(l.text.resetButtonText??((r=e.unref(f))==null?void 0:r("table.reset"))),1)]}),_:1}),e.createVNode(e.unref(x.KButton),{class:"filter-btn-item",size:"sm",secondary:"",onClick:y},{default:e.withCtx(()=>{var r;return[e.createTextVNode(e.toDisplayString(l.text.confirmButtonText??((r=e.unref(f))==null?void 0:r("table.filter"))),1)]}),_:1})])):e.createCommentVNode("",!0)]}):e.createCommentVNode("",!0)]),_:3},8,["trigger","disabled","visible"])}}});exports.default=j;
