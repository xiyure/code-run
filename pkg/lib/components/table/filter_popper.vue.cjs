"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});require("../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const T=require("../popover/index.cjs"),F=require("../checkbox/index.cjs"),N=require("../button/index.cjs"),O=require("../../hooks/use_locale.cjs"),l=require("../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs"),n=require("../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),c=require("../../node_modules/@vue/runtime-core/node_modules/@vue/shared/dist/shared.esm-bundler.cjs"),R={key:0,class:"filter-menu"},U={class:"filter-menu-item"},j=["onClick"],H={key:2,class:"filter-buttons"},I=l.defineComponent({__name:"filter_popper",props:{filters:{default:()=>[]},column:{default:()=>({})},trigger:{default:"hover"},visible:{type:Boolean,default:void 0},text:{default:()=>({})},teleported:{type:Boolean,default:!1},destroyOnClose:{type:Boolean,default:!1},filterMultiple:{type:Boolean,default:!0}},emits:["set-filter","clear-filter","filter-visible","close-filter-panel"],setup(A,{expose:q,emit:w}){const u=A,{t:v}=O.useLocale(),m=w,k=n.ref(),s=n.ref(!1),f=n.ref(!1),h=n.ref(!1),a=n.ref([]);let B="[]";const b=l.computed(()=>{var e;return((e=u.filters.find(t=>t.checked))==null?void 0:e.value)??null});l.watch(()=>u.filters,e=>{a.value=Array.isArray(e)?e:[],p(),d()},{immediate:!0});function g(e){var t;m("filter-visible",{column:u.column,field:(t=u.column)==null?void 0:t.field,visible:e,filterList:a.value})}function L(){h.value=!0}function P(){u.destroyOnClose&&(h.value=!1)}function p(){var t,i;if(!Array.isArray(a.value)){s.value=!1;return}s.value=(t=a.value)==null?void 0:t.every(o=>o.checked);const e=(i=a.value)==null?void 0:i.some(o=>o.checked);!s.value&&e?f.value=!0:f.value=!1}function _(){var e;s.value&&f.value&&(f.value=!1),(e=a.value)==null||e.forEach(t=>{t.checked=s.value})}function M(e,t){b.value!==t.value&&(S(),t.checked=!0,V(e))}function V(e){const{hasChange:t,values:i}=d();t&&m("set-filter",{column:u.column,field:u.column.field,filterList:a.value,values:i,$event:e})}function E(e){a.value.forEach(i=>{i.checked=!1}),f.value=!1,s.value=!1;const{hasChange:t}=d();t&&m("clear-filter",{filterList:a.value,$event:e})}function $(){var e;if(u.visible===void 0){(e=k.value)==null||e.hide();return}m("close-filter-panel")}function d(){const e=a.value.filter(o=>o.checked).map(o=>o.value),t=JSON.stringify(e),i=B!==t;return i&&(B=t),{hasChange:i,values:e}}function z(e){a.value=Array.isArray(e)?e:[],p(),d()}function S(){a.value.forEach(e=>{e.checked=!1}),p(),d()}function D(){}function K(){}return q({popperRef:l.computed(()=>{var e,t;return(t=(e=k.value)==null?void 0:e.popperRef)==null?void 0:t.contentRef}),setFilter:z,clearFilter:S,resetFilterPanel:D,saveFilterPanel:K,closeFilterPanel:$}),(e,t)=>{var i;return l.openBlock(),l.createBlock(n.unref(T.KPopover),{ref_key:"filterPopper",ref:k,trigger:e.trigger,"show-arrow":!1,placement:"right-start","popper-class":"filter-box",offset:2,disabled:!((i=a.value)!=null&&i.length),teleported:!0,visible:e.visible,onShow:t[2]||(t[2]=()=>{g(!0)}),onHide:t[3]||(t[3]=()=>{g(!1)}),onBeforeEnter:L,onAfterLeave:P},{reference:l.withCtx(()=>[l.renderSlot(e.$slots,"default",{disabled:!a.value.length})]),default:l.withCtx(()=>[h.value?l.renderSlot(e.$slots,"filter",{key:0},()=>{var o,x;return[e.filterMultiple?(l.openBlock(),l.createElementBlock("ul",R,[l.createElementVNode("li",U,[l.createVNode(n.unref(F.KCheckbox),{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=r=>s.value=r),label:(o=n.unref(v))==null?void 0:o("table.all"),value:"all",indeterminate:f.value,onChange:_},null,8,["modelValue","label","indeterminate"])]),(l.openBlock(!0),l.createElementBlock(l.Fragment,null,l.renderList(a.value,(r,C)=>(l.openBlock(),l.createElementBlock("li",{key:C,class:"filter-menu-item"},[l.createVNode(n.unref(F.KCheckbox),{modelValue:r.checked,"onUpdate:modelValue":y=>r.checked=y,label:r.label,value:r.value,onChange:p},null,8,["modelValue","onUpdate:modelValue","label","value"])]))),128))])):(l.openBlock(),l.createElementBlock("ul",{key:1,class:c.normalizeClass(["filter-menu",{"filter-multiple-disabled":!e.filterMultiple}])},[l.createElementVNode("li",{class:c.normalizeClass(["filter-menu-item",{"is-active":b.value===null}]),onClick:t[1]||(t[1]=r=>{E(r)})},c.toDisplayString((x=n.unref(v))==null?void 0:x("table.all")),3),(l.openBlock(!0),l.createElementBlock(l.Fragment,null,l.renderList(a.value,(r,C)=>(l.openBlock(),l.createElementBlock("li",{key:C,class:c.normalizeClass(["filter-menu-item",{"is-active":b.value===r.value}]),onClick:y=>{M(y,r)}},c.toDisplayString(r.label),11,j))),128))],2)),e.filterMultiple?(l.openBlock(),l.createElementBlock("div",H,[l.createVNode(n.unref(N.KButton),{size:"sm",onClick:E},{default:l.withCtx(()=>{var r;return[l.createTextVNode(c.toDisplayString(e.text.resetButtonText??((r=n.unref(v))==null?void 0:r("table.reset"))),1)]}),_:1}),l.createVNode(n.unref(N.KButton),{class:"filter-btn-item",size:"sm",secondary:"",onClick:V},{default:l.withCtx(()=>{var r;return[l.createTextVNode(c.toDisplayString(e.text.confirmButtonText??((r=n.unref(v))==null?void 0:r("table.filter"))),1)]}),_:1})])):l.createCommentVNode("",!0)]}):l.createCommentVNode("",!0)]),_:3},8,["trigger","disabled","visible"])}}});exports.default=I;
