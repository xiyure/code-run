"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),J=require("../dialog/index.cjs"),B=require("../form/index.cjs"),q=require("../checkbox/index.cjs"),w=require("../radio/index.cjs"),Q=require("../tree_select/index.cjs"),X=require("../input/index.cjs"),F=require("../button/index.cjs"),Y=require("../select/index.cjs"),Z=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const I=require("../../hooks/use_locale.cjs");function V(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!e.isVNode(h)}const A=e.defineComponent({__name:"dialog",setup(h,{expose:G}){const{t:C}=I.useLocale(),_=e.reactive([]),b=new Map,K=e.ref();function L(t,n){const o=n.reduce((i,l)=>{const{prop:r,value:a=""}=l;return r?(i[r]=a,i):console.warn("exist form item without prop")},{}),u=e.reactive({labelPosition:"top",model:o,labelWidth:"100",...t}),d=n.map(i=>{const l=e.reactive(i??{}),r=M(u,l);return i.noFormItemWrap&&typeof r=="function"?r():e.createVNode(B.KFormItem,l,V(r)?r:{default:()=>[r]})});return[u,d]}function M(t,n){const{attrs:o,type:u,prop:d,render:i}=n,l=d;if(typeof i=="function")return i(n,t.model,t);switch(u){case"select":if(!Array.isArray(n.options)){console.error("please provide correct options for select type");return}return()=>{let r;return e.createVNode(Y.KSelect,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":a=>t.model[l]=a},o),V(r=e.reactive(n.options).map(a=>e.createVNode(e.resolveComponent("k-option"),{label:a.label,value:a.value},null)))?r:{default:()=>[r]})};case"checkbox":return()=>e.createVNode(q.KCheckbox,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":r=>t.model[l]=r},o),null);case"checkboxGroup":if(!Array.isArray(n.options)){console.error("checkboxGroup 类型需要传入正确的 options");return}return()=>{let r;return e.createVNode(q.KCheckboxGroup,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":a=>t.model[l]=a},o),V(r=e.reactive(n.options).map(a=>e.createVNode(q.KCheckbox,{label:a.label,value:a.value},null)))?r:{default:()=>[r]})};case"radio":return()=>e.createVNode(w.KRadio,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":r=>t.model[l]=r},o),null);case"radioGroup":if(!Array.isArray(n.options)){console.error("checkboxGroup 类型需要传入正确的 options");return}return()=>{let r;return e.createVNode(w.KRadioGroup,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":a=>t.model[l]=a},o),V(r=e.reactive(n.options).map(a=>e.createVNode(w.KRadio,{label:a.label,value:a.value},null)))?r:{default:()=>[r]})};case"treeSelect":return()=>e.createVNode(Q.KTreeSelect,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":r=>t.model[l]=r},o),null);default:return()=>e.createVNode(X.KInput,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":r=>t.model[l]=r},o),null)}}function O({id:t=`dialog_${Z.genRandomStr(8)}`,attrs:n,slots:o={},formItems:u,formAttrs:d={},confirm:i,cancel:l,penetratePointer:r=!1,showDefaultFooter:a=!0,showCancelButton:T=!0,showConfirmButton:W=!0,confirmButtonText:y=C("dialog.confirm"),cancelButtonText:N=C("dialog.cancel"),...z}){if(n=n??z,r&&(n.modal=!1),typeof o=="function"&&(o={default:o}),u&&o.default)return Promise.reject(new TypeError("formItems and default slots cannot be used together"));if(!o.default&&!u)return Promise.reject(new TypeError("must provide default slot or formItems"));const p=e.reactive({draggable:!0,modelValue:!0,closeOnClickModal:!1,width:"500",alignCenter:!0,...n}),k=()=>{p.modelValue=!1},v=e.ref(null);let f,S;const s={ref:v,dialogAttrs:p,formAttrs:d,formItems:u,confirm:null,cancel:null,close:k},H={header:()=>o.header?o.header(s):e.createVNode("div",{class:"el-dialog__title"},[p.title]),default:()=>o.default?o.default(s):([f,S]=L(d,u),e.createVNode(B.KForm,e.mergeProps({ref:v},f),{default:()=>S})),footer:()=>{var g;if(!a)return"";if(s.confirm=async c=>{var $,E,R,U,j;typeof(($=v.value)==null?void 0:$.validate)=="function"&&await((R=(E=v.value).validate)==null?void 0:R.call(E));try{c instanceof Event?(c={ok:!0,dialogAttrs:p},u?(c.form=f==null?void 0:f.model,c.formAttrs=f):typeof((U=v.value)==null?void 0:U.getResult)=="function"&&(c.result=await((j=v.value)==null?void 0:j.getResult()))):c={ok:!0,result:c},typeof i=="function"?await i(k,c):(P(t,c),k())}catch(x){console.error(x.error?x.error.toString():x.toString())}},s.cancel=async()=>{try{typeof l=="function"&&await l(p,f,u),k()}catch(c){console.error(c.toString())}},o.footer)return s.formAttrs=f,o.footer(s);const m=typeof o.footerLeft=="function";return e.createVNode("div",{class:`k-dialog-service-footer${m?" k-dialog-service-footer-has-left":""}`},[m?e.createVNode("div",{class:"k-dialog-service-footer-left"},[(g=o.footerLeft)==null?void 0:g.call(o,s)]):"",T!==!1&&e.createVNode(F.KButton,{class:"k-dialog-service-cancel-button__default",onClick:s.cancel},V(N)?N:{default:()=>[N]}),W!==!1&&e.createVNode(F.KButton,{onClick:s.confirm,main:!0},V(y)?y:{default:()=>[y]})])}};return _.push({id:t,attrs:p,slots:H}),r&&e.nextTick().then(()=>{const m=p.appendTo??K.value,g=m.querySelector(`#${t}`);g&&(g.style.pointerEvents="auto");let c=g.parentElement;for(;c!==m;)c.style.pointerEvents="none",c=c.parentElement}),typeof i=="function"?k:new Promise(m=>{b.set(t,m)})}function P(t,n){const o=b.get(t);o&&(o(n),b.delete(t))}function D(t){P(t,{ok:!1});const n=_.findIndex(o=>o.id===t);n!==-1&&_.splice(n,1)}return G({showDialog:O}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"root",ref:K,class:"k-dialogs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_,o=>(e.openBlock(),e.createBlock(e.unref(J.KDialog),e.mergeProps(o.attrs,{id:o.id,key:o.id,onClosed:u=>D(o.id)}),e.createSlots({_:2},[e.renderList(o.slots,(u,d)=>({name:d,fn:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(o.slots[d])))])}))]),1040,["id","onClosed"]))),128))],512))}});exports.default=A;
