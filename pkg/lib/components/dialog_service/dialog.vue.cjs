"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});require("../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const Q=require("../dialog/index.cjs"),F=require("../form/index.cjs"),C=require("../checkbox/index.cjs"),w=require("../radio/index.cjs"),X=require("../tree_select/index.cjs"),Y=require("../input/index.cjs"),G=require("../button/index.cjs"),Z=require("../select/index.cjs"),I=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const A=require("../../hooks/use_locale.cjs"),e=require("../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs"),d=require("../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs");function k(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!e.isVNode(h)}const ee=e.defineComponent({__name:"dialog",setup(h,{expose:L}){const{t:K}=A.useLocale(),y=d.reactive([]),b=new Map,P=d.ref();function M(t,n){const r=n.reduce((i,l)=>{const{prop:o,value:a=""}=l;return o?(i[o]=a,i):console.warn("exist form item without prop")},{}),u=d.reactive({labelPosition:"top",model:r,labelWidth:"100",...t}),s=n.map(i=>{const l=d.reactive(i??{}),o=O(u,l);return i.noFormItemWrap&&typeof o=="function"?o():e.createVNode(F.KFormItem,l,k(o)?o:{default:()=>[o]})});return[u,s]}function O(t,n){const{attrs:r,type:u,prop:s,render:i}=n,l=s;if(typeof i=="function")return i(n,t.model,t);switch(u){case"select":if(!Array.isArray(n.options)){console.error("please provide correct options for select type");return}return()=>{let o;return e.createVNode(Z.KSelect,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":a=>t.model[l]=a},r),k(o=d.reactive(n.options).map(a=>e.createVNode(e.resolveComponent("k-option"),{label:a.label,value:a.value},null)))?o:{default:()=>[o]})};case"checkbox":return()=>e.createVNode(C.KCheckbox,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":o=>t.model[l]=o},r),null);case"checkboxGroup":if(!Array.isArray(n.options)){console.error("checkboxGroup 类型需要传入正确的 options");return}return()=>{let o;return e.createVNode(C.KCheckboxGroup,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":a=>t.model[l]=a},r),k(o=d.reactive(n.options).map(a=>e.createVNode(C.KCheckbox,{label:a.label,value:a.value},null)))?o:{default:()=>[o]})};case"radio":return()=>e.createVNode(w.KRadio,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":o=>t.model[l]=o},r),null);case"radioGroup":if(!Array.isArray(n.options)){console.error("checkboxGroup 类型需要传入正确的 options");return}return()=>{let o;return e.createVNode(w.KRadioGroup,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":a=>t.model[l]=a},r),k(o=d.reactive(n.options).map(a=>e.createVNode(w.KRadio,{label:a.label,value:a.value},null)))?o:{default:()=>[o]})};case"treeSelect":return()=>e.createVNode(X.KTreeSelect,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":o=>t.model[l]=o},r),null);default:return()=>e.createVNode(Y.KInput,e.mergeProps({modelValue:t.model[l],"onUpdate:modelValue":o=>t.model[l]=o},r),null)}}function D({id:t=`dialog_${I.genRandomStr(8)}`,attrs:n,slots:r={},formItems:u,formAttrs:s={},confirm:i,cancel:l,penetratePointer:o=!1,showDefaultFooter:a=!0,showCancelButton:W=!0,showConfirmButton:z=!0,confirmButtonText:N=K("dialog.confirm"),cancelButtonText:q=K("dialog.cancel"),...H}){if(n=n??H,o&&(n.modal=!1),typeof r=="function"&&(r={default:r}),u&&r.default)return Promise.reject(new TypeError("formItems and default slots cannot be used together"));if(!r.default&&!u)return Promise.reject(new TypeError("must provide default slot or formItems"));const m=d.reactive({draggable:!0,modelValue:!0,closeOnClickModal:!1,width:"500",alignCenter:!0,...n}),_=()=>{m.modelValue=!1},g=d.ref(null);let p,$;const f={ref:g,dialogAttrs:m,formAttrs:s,formItems:u,confirm:null,cancel:null,close:_},J={header:()=>r.header?r.header(f):e.createVNode("div",{class:"el-dialog__title"},[m.title]),default:()=>r.default?r.default(f):([p,$]=M(s,u),e.createVNode(F.KForm,e.mergeProps({ref:g},p),{default:()=>$})),footer:()=>{var V;if(!a)return"";if(f.confirm=async c=>{var E,B,R,U,j;typeof((E=g.value)==null?void 0:E.validate)=="function"&&await((R=(B=g.value).validate)==null?void 0:R.call(B));try{c instanceof Event?(c={ok:!0,dialogAttrs:m},u?(c.form=p==null?void 0:p.model,c.formAttrs=p):typeof((U=g.value)==null?void 0:U.getResult)=="function"&&(c.result=await((j=g.value)==null?void 0:j.getResult()))):c={ok:!0,result:c},typeof i=="function"?await i(_,c):(S(t,c),_())}catch(x){console.error(x.error?x.error.toString():x.toString())}},f.cancel=async()=>{try{typeof l=="function"&&await l(m,p,u),_()}catch(c){console.error(c.toString())}},r.footer)return f.formAttrs=p,r.footer(f);const v=typeof r.footerLeft=="function";return e.createVNode("div",{class:`k-dialog-service-footer${v?" k-dialog-service-footer-has-left":""}`},[v?e.createVNode("div",{class:"k-dialog-service-footer-left"},[(V=r.footerLeft)==null?void 0:V.call(r,f)]):"",W!==!1&&e.createVNode(G.KButton,{class:"k-dialog-service-cancel-button__default",onClick:f.cancel},k(q)?q:{default:()=>[q]}),z!==!1&&e.createVNode(G.KButton,{onClick:f.confirm,main:!0},k(N)?N:{default:()=>[N]})])}};return y.push({id:t,attrs:m,slots:J}),o&&e.nextTick().then(()=>{const v=m.appendTo??P.value,V=v.querySelector(`#${t}`);V&&(V.style.pointerEvents="auto");let c=V.parentElement;for(;c!==v;)c.style.pointerEvents="none",c=c.parentElement}),typeof i=="function"?_:new Promise(v=>{b.set(t,v)})}function S(t,n){const r=b.get(t);r&&(r(n),b.delete(t))}function T(t){S(t,{ok:!1});const n=y.findIndex(r=>r.id===t);n!==-1&&y.splice(n,1)}return L({showDialog:D}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"root",ref:P,class:"k-dialogs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y,r=>(e.openBlock(),e.createBlock(d.unref(Q.KDialog),e.mergeProps(r.attrs,{id:r.id,key:r.id,onClosed:u=>T(r.id)}),e.createSlots({_:2},[e.renderList(r.slots,(u,s)=>({name:s,fn:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(r.slots[s])))])}))]),1040,["id","onClosed"]))),128))],512))}});exports.default=ee;
