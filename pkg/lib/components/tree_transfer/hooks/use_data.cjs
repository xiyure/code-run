"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("../../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const P=require("../../../constant/CN_dict.cjs"),T=require("../../../utils/utils.cjs");require("../../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../../node_modules/culori/src/index.cjs");const G=require("../const.cjs"),Y=require("../../../node_modules/lodash-es/cloneDeep.cjs"),k=require("../../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),h=require("../../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs");function Q(N,l,S,_,b,O){const s={treeDataMap:new Map,tableDataMap:new Map},p=k.ref(Y.default(G.DEFAULT_PAGE_CONFIG));h.watch(()=>l.value.paginationConfig,()=>{p.value=Object.assign(p.value,l.value.paginationConfig||{})},{immediate:!0,deep:!0});const m=h.computed(()=>E()),K=h.computed(()=>{const{isRemotePaging:t}=p.value;return!D.value||t?m.value:z(m.value)}),D=h.computed(()=>l.value.showPage&&!l.value.useTree),x=h.computed(()=>{const{isRemotePaging:t,total:e}=p.value;return D.value&&t?e:m.value.length});function E(){var g,c,f;const t=b.value,e=l.value.useTree?((g=l.value.treeConfig)==null?void 0:g.parentField)??"pid":void 0;s.tableDataMap=T.convertToMap(b.value,l.value.rowKey??"id",e);const{strict:u,searchMethod:n,ignoreCase:a=!1,searchColumns:r}=l.value.searchConfig??{},i=O.value.trim();if((c=l.value.searchConfig)!=null&&c.isRemoteQuery)return S("remote-query",i),t;if(!i)return t;if(typeof n=="function")return[n(i,t)];const w=_.value.filter(o=>o.visible!==!1).map(o=>o.field?o.field:null).filter(o=>o!==null);let d=t.filter(o=>w.some(v=>{var C,L;if(Array.isArray(r)&&!r.includes(v))return!1;const y=((L=(C=N.value)==null?void 0:C.getCellLabel)==null?void 0:L.call(C,o,v))??"";if(u===!0)return y.toString()===i;const A=a?String(y).toLowerCase():String(y),I=a?i.toLowerCase():i;return A.indexOf(I)!==-1||R(v,A,I,a)}));if(l.value.useTree){const o=((f=l.value.treeConfig)==null?void 0:f.rowField)??"id";j(d),d=T.sortFunc([...s.treeDataMap.values()],b.value,o)}else B(d.length);return d}function R(t,e,u,n=!1){var d,g;const a=((d=l.value.searchConfig)==null?void 0:d.supportPinYin)??!1;if(a!==!0&&!(Array.isArray(a)&&a.includes(t)))return!1;let r="";const i=[],M=new RegExp(`${Object.keys(P.TONE_MARKS).join("|")}`,"g");for(let c=0;c<e.length;c++){const f=(g=P.CN_DICT[e[c]])==null?void 0:g.replace(M,v=>P.TONE_MARKS[v]);if(!f){r+=e[c];continue}const o=f.split(",");o.length>1?(r!=null&&r.length&&i.push([r]),i.push(o),r=""):r+=f}r.length&&i.push([r]);const w=T.getAllCombinations(i);for(const c of w)if((n?c.toLowerCase():c).indexOf(u)!==-1)return!0;return!1}function j(t){var n,a;const e=((n=l.value.treeConfig)==null?void 0:n.rowField)??"id",u=((a=l.value.treeConfig)==null?void 0:a.parentField)??"pid";s.treeDataMap.clear();for(let r=0;r<t.length;r++){const i=t[r];s.treeDataMap.get(i[e])||(s.treeDataMap.set(i[e],i),F(i,u))}q(t)}function q(t){if(!t||!t.length)return;const e=l.value.rowKey??"id";for(const u of t){const n=s.tableDataMap.get(u[e]);n&&(n.children.forEach(a=>{s.treeDataMap.get(a[e])||s.treeDataMap.set(a[e],a)}),q(n.children))}}function F(t,e,u){var r;const n=t[e],a=(r=s.tableDataMap.get(n))==null?void 0:r.node;a&&(s.treeDataMap.get(n)||s.treeDataMap.set(n,a),a[e]!==null&&F(a,e))}function z(t){const{currentPage:e,pageSize:u}=p.value,n=(e-1)*u,a=n+u;return t.slice(n,a)}function B(t){let{currentPage:e}=p.value;const u=p.value.pageSize;for(;(e-1)*u+1>t&&e>1;)e--;p.value.currentPage=e}return{showTableData:K,visibleData:m,dataLength:x,isPaging:D,tableCacheData:s,paginationConfig:p}}exports.useData=Q;
