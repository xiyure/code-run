"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const g=require("vue"),P=require("../../../constant/CN_dict.cjs"),T=require("../../../utils/utils.cjs");require("../../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../../node_modules/culori/src/index.cjs");const Y=require("../const.cjs"),k=require("../../../node_modules/lodash-es/cloneDeep.cjs");function B(N,o,S,O,b,K){const s={treeDataMap:new Map,tableDataMap:new Map},p=g.ref(k.default(Y.DEFAULT_PAGE_CONFIG));g.watch(()=>o.value.paginationConfig,()=>{p.value=Object.assign(p.value,o.value.paginationConfig||{})},{immediate:!0,deep:!0});const C=g.computed(()=>E()),_=g.computed(()=>{const{isRemotePaging:t}=p.value;return!D.value||t?C.value:z(C.value)}),D=g.computed(()=>o.value.showPage&&!o.value.useTree),x=g.computed(()=>{const{isRemotePaging:t,total:e}=p.value;return D.value&&t?e:C.value.length});function E(){var v,c,d;const t=b.value,e=o.value.useTree?((v=o.value.treeConfig)==null?void 0:v.parentField)??"pid":void 0;s.tableDataMap=T.convertToMap(b.value,o.value.rowKey??"id",e);const{strict:i,searchMethod:n,ignoreCase:a=!1,searchColumns:r}=o.value.searchConfig??{},l=K.value.trim();if((c=o.value.searchConfig)!=null&&c.isRemoteQuery)return S("remote-query",l),t;if(!l)return t;if(typeof n=="function")return[n(l,t)];const w=O.value.filter(u=>u.visible!==!1).map(u=>u.field?u.field:null).filter(u=>u!==null);let f=t.filter(u=>w.some(h=>{var m,L;if(Array.isArray(r)&&!r.includes(h))return!1;const y=((L=(m=N.value)==null?void 0:m.getCellLabel)==null?void 0:L.call(m,u,h))??"";if(i===!0)return y.toString()===l;const A=a?String(y).toLowerCase():String(y),I=a?l.toLowerCase():l;return A.indexOf(I)!==-1||R(h,A,I,a)}));if(o.value.useTree){const u=((d=o.value.treeConfig)==null?void 0:d.rowField)??"id";j(f),f=T.sortFunc([...s.treeDataMap.values()],b.value,u)}else G(f.length);return f}function R(t,e,i,n=!1){var f,v;const a=((f=o.value.searchConfig)==null?void 0:f.supportPinYin)??!1;if(a!==!0&&!(Array.isArray(a)&&a.includes(t)))return!1;let r="";const l=[],M=new RegExp(`${Object.keys(P.TONE_MARKS).join("|")}`,"g");for(let c=0;c<e.length;c++){const d=(v=P.CN_DICT[e[c]])==null?void 0:v.replace(M,h=>P.TONE_MARKS[h]);if(!d){r+=e[c];continue}const u=d.split(",");u.length>1?(r!=null&&r.length&&l.push([r]),l.push(u),r=""):r+=d}r.length&&l.push([r]);const w=T.getAllCombinations(l);for(const c of w)if((n?c.toLowerCase():c).indexOf(i)!==-1)return!0;return!1}function j(t){var n,a;const e=((n=o.value.treeConfig)==null?void 0:n.rowField)??"id",i=((a=o.value.treeConfig)==null?void 0:a.parentField)??"pid";s.treeDataMap.clear();for(let r=0;r<t.length;r++){const l=t[r];s.treeDataMap.get(l[e])||(s.treeDataMap.set(l[e],l),q(l,i))}F(t)}function F(t){if(!t||!t.length)return;const e=o.value.rowKey??"id";for(const i of t){const n=s.tableDataMap.get(i[e]);n&&(n.children.forEach(a=>{s.treeDataMap.get(a[e])||s.treeDataMap.set(a[e],a)}),F(n.children))}}function q(t,e,i){var r;const n=t[e],a=(r=s.tableDataMap.get(n))==null?void 0:r.node;a&&(s.treeDataMap.get(n)||s.treeDataMap.set(n,a),a[e]!==null&&q(a,e))}function z(t){const{currentPage:e,pageSize:i}=p.value,n=(e-1)*i,a=n+i;return t.slice(n,a)}function G(t){let{currentPage:e}=p.value;const i=p.value.pageSize;for(;(e-1)*i+1>t&&e>1;)e--;p.value.currentPage=e}return{showTableData:_,visibleData:C,dataLength:x,isPaging:D,tableCacheData:s,paginationConfig:p}}exports.useData=B;
