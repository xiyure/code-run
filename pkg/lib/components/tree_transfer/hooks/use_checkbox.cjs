"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const k=require("vue"),T=require("../../../node_modules/lodash-es/cloneDeep.cjs");function q(l,v,x,b,w){const S={},C=k.ref(new Set),f=k.ref(new Set),A=k.computed(()=>C.value.size);k.nextTick(()=>{const{checkRowKeys:e,checkAll:t}=R.value,c=Array.isArray(e)?e:[],a=t?x.value.filter(n=>n==null?void 0:n[s.value]):c.map(n=>{var o;return(o=w.tableDataMap.get(n))==null?void 0:o.node}).filter(n=>n);g(a)});const R=k.computed(()=>Object.assign(S,v.value.checkboxConfig||{})),s=k.computed(()=>v.value.rowKey??"id");function g(e){p(),d(e,!0)}const D=(e,t)=>new Promise(c=>{var o,u;const a=Array.isArray(e)?e:[e],n=[];for(const i of a){if(y(i)||!(i!=null&&i[s.value]))continue;const r=(o=l.value)==null?void 0:o.getRowById(i[s.value]);n.push(r??i)}d(n,t),(u=l.value)==null||u.setCheckboxRow(n,t),c({rows:e,checked:t})}),M=e=>new Promise(t=>{var a,n,o;const c=[];if(e){for(const u of x.value){if(y(u)||!(u!=null&&u[s.value]))continue;const i=(a=l.value)==null?void 0:a.getRowById(u[s.value]);c.push(i??u)}d(c,e),(n=l.value)==null||n.setCheckboxRow(c,e)}else p(),(o=l.value)==null||o.setAllCheckboxRow(e);t({checked:e})}),d=(e,t)=>{if(R.value.reserve===!1)return;const c=Array.isArray(e)?e:[e];for(const a of c)m(a,t)},m=(e,t)=>{if(!e||!(e!=null&&e[s.value]))return;t?C.value.add(e[s.value]):C.value.delete(e[s.value]);const c=w.tableDataMap.get(e[s.value]);if(!c||!c.children||c.children.length===0){t?f.value.add(e[s.value]):f.value.delete(e[s.value]);return}if(R.value.checkStrictly!==!0)for(const a of c.children)m(a,t)};async function P(){var t,c,a,n;if(await((t=l.value)==null?void 0:t.clearCheckboxRow()),await((c=l.value)==null?void 0:c.clearCheckboxReserve()),f.value.size===0)return;const e=[];for(const o of f.value.values()){const u=(a=l.value)==null?void 0:a.getRowById(o);u&&e.push(u)}(n=l.value)==null||n.setCheckboxRow(e,!0)}const z=()=>new Promise(e=>{var t;v.value.showPage&&!v.value.useTree?d(b.value,!1):p(),(t=l.value)==null||t.clearCheckboxRow(),e(void 0)}),F=async()=>{var e;await((e=l.value)==null?void 0:e.clearCheckboxReserve()),new Promise(t=>{var c,a;if(v.value.showPage&&!v.value.useTree){const n=(c=l.value)==null?void 0:c.getCheckboxRecords();C.value=new Set(n.map(o=>o==null?void 0:o[s.value])),(a=l.value)==null||a.setCheckboxRow(n,!0)}t(void 0)})};function I({row:e,checked:t}){d(e,t)}function B({checked:e}){const t=b.value.filter(c=>!c.children||!c.children.length);d(t,e)}function y(e){const{visibleMethod:t,checkMethod:c}=R.value;return typeof t=="function"&&!t({$table:l.value,row:e})||typeof c=="function"&&!c({$table:l.value,row:e})}function p(){C.value.clear(),f.value.clear()}function K(e=!1){var c,a,n;if(!e)return(c=l.value)==null?void 0:c.getCheckboxRecords();const t=T.default(f.value);if(v.value.useTree){const o=new Map,u=((a=v.value.treeConfig)==null?void 0:a.rowField)??"id",i=((n=v.value.treeConfig)==null?void 0:n.parentField)??"pid";for(const r of x.value)r[u]&&(o.has(r[u])||o.set(r[u],{id:r[u],pid:r[i],childrenSize:0,current:0}),o.has(r[i])&&o.get(r[i]).childrenSize++);for(const r of f.value.values()){let h=o.get(o.get(r).pid);for(h&&h.current++;h&&h.current===h.childrenSize;)t.add(h.id),h=o.get(h.pid),h&&h.current++}}return x.value.filter(o=>(o==null?void 0:o[s.value])&&t.has(o[s.value]))}function j(e){const t=typeof e=="object"?e[v.value.rowKey]:e;return f.value.has(t)}return{_checkboxMethods:{setAllCheckboxRow:M,setCheckboxRow:D,clearCheckboxRow:z,clearCheckboxReserve:F,getCheckboxRecords:K,isCheckedRow:j},init:g,checkBoxChange:I,checkboxAllChange:B,isCheckboxDisabled:y,clearCheckedData:p,resetCheckboxStatus:P,checkedDataSize:A,checkboxConfig:R,checkedLeafData:f}}exports.useCheckbox=q;
