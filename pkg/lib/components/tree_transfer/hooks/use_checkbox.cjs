"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("../../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const T=require("../../../node_modules/lodash-es/cloneDeep.cjs"),S=require("../../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),y=require("../../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs");function _(l,v,R,b,w){const A={},k=S.ref(new Set),f=S.ref(new Set),D=y.computed(()=>k.value.size);y.nextTick(()=>{const{checkRowKeys:e,checkAll:t}=C.value,c=Array.isArray(e)?e:[],u=t?R.value.filter(o=>o==null?void 0:o[s.value]):c.map(o=>{var n;return(n=w.tableDataMap.get(o))==null?void 0:n.node}).filter(o=>o);g(u)});const C=y.computed(()=>Object.assign(A,v.value.checkboxConfig||{})),s=y.computed(()=>v.value.rowKey??"id");function g(e){x(),d(e,!0)}const M=(e,t)=>new Promise(c=>{var n,a;const u=Array.isArray(e)?e:[e],o=[];for(const r of u){if(p(r)||!(r!=null&&r[s.value]))continue;const i=(n=l.value)==null?void 0:n.getRowById(r[s.value]);o.push(i??r)}d(o,t),(a=l.value)==null||a.setCheckboxRow(o,t),c({rows:e,checked:t})}),P=e=>new Promise(t=>{var u,o,n;const c=[];if(e){for(const a of R.value){if(p(a)||!(a!=null&&a[s.value]))continue;const r=(u=l.value)==null?void 0:u.getRowById(a[s.value]);c.push(r??a)}d(c,e),(o=l.value)==null||o.setCheckboxRow(c,e)}else x(),(n=l.value)==null||n.setAllCheckboxRow(e);t({checked:e})}),d=(e,t)=>{if(C.value.reserve===!1)return;const c=Array.isArray(e)?e:[e];for(const u of c)m(u,t)},m=(e,t)=>{if(!e||!(e!=null&&e[s.value]))return;t?k.value.add(e[s.value]):k.value.delete(e[s.value]);const c=w.tableDataMap.get(e[s.value]);if(!c||!c.children||c.children.length===0){t?f.value.add(e[s.value]):f.value.delete(e[s.value]);return}if(C.value.checkStrictly!==!0)for(const u of c.children)m(u,t)};async function z(){var t,c,u,o;if(await((t=l.value)==null?void 0:t.clearCheckboxRow()),await((c=l.value)==null?void 0:c.clearCheckboxReserve()),f.value.size===0)return;const e=[];for(const n of f.value.values()){const a=(u=l.value)==null?void 0:u.getRowById(n);a&&e.push(a)}(o=l.value)==null||o.setCheckboxRow(e,!0)}const B=()=>new Promise(e=>{var t;v.value.showPage&&!v.value.useTree?d(b.value,!1):x(),(t=l.value)==null||t.clearCheckboxRow(),e(void 0)}),F=async()=>{var e;await((e=l.value)==null?void 0:e.clearCheckboxReserve()),new Promise(t=>{var c,u;if(v.value.showPage&&!v.value.useTree){const o=(c=l.value)==null?void 0:c.getCheckboxRecords();k.value=new Set(o.map(n=>n==null?void 0:n[s.value])),(u=l.value)==null||u.setCheckboxRow(o,!0)}t(void 0)})};function I({row:e,checked:t}){d(e,t)}function q({checked:e}){const t=b.value.filter(c=>!c.children||!c.children.length);d(t,e)}function p(e){const{visibleMethod:t,checkMethod:c}=C.value;return typeof t=="function"&&!t({$table:l.value,row:e})||typeof c=="function"&&!c({$table:l.value,row:e})}function x(){k.value.clear(),f.value.clear()}function K(e=!1){var c,u,o;if(!e)return(c=l.value)==null?void 0:c.getCheckboxRecords();const t=T.default(f.value);if(v.value.useTree){const n=new Map,a=((u=v.value.treeConfig)==null?void 0:u.rowField)??"id",r=((o=v.value.treeConfig)==null?void 0:o.parentField)??"pid";for(const i of R.value)i[a]&&(n.has(i[a])||n.set(i[a],{id:i[a],pid:i[r],childrenSize:0,current:0}),n.has(i[r])&&n.get(i[r]).childrenSize++);for(const i of f.value.values()){let h=n.get(n.get(i).pid);for(h&&h.current++;h&&h.current===h.childrenSize;)t.add(h.id),h=n.get(h.pid),h&&h.current++}}return R.value.filter(n=>(n==null?void 0:n[s.value])&&t.has(n[s.value]))}function j(e){const t=typeof e=="object"?e[v.value.rowKey]:e;return f.value.has(t)}return{_checkboxMethods:{setAllCheckboxRow:P,setCheckboxRow:M,clearCheckboxRow:B,clearCheckboxReserve:F,getCheckboxRecords:K,isCheckedRow:j},init:g,checkBoxChange:I,checkboxAllChange:q,isCheckboxDisabled:p,clearCheckedData:x,resetCheckboxStatus:z,checkedDataSize:D,checkboxConfig:C,checkedLeafData:f}}exports.useCheckbox=_;
