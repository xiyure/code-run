"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});require("../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const v=require("../table/index.cjs"),V=require("../input/index.cjs"),x=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const Se=require("./hooks/use_checkbox.cjs"),H=require("./hooks/use_data.cjs"),Ve=require("./hooks/use_config.cjs"),xe=require("../../hooks/use_locale.cjs"),U=require("./page.vue.cjs");;/* empty css            */const e=require("../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs"),o=require("../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),Y=require("../../node_modules/@vue/runtime-dom/dist/runtime-dom.esm-bundler.cjs"),O=require("../../node_modules/ksw-vue-icon/es/icons/base/search.cjs"),c=require("../../node_modules/@vue/runtime-core/node_modules/@vue/shared/dist/shared.esm-bundler.cjs"),Ie=require("../../node_modules/ksw-vue-icon/es/icons/base/close.cjs"),Ke={key:0,class:"k-transfer__filter !mb-3"},Pe={class:"flex justify-between items-center gap-2"},Ne={class:"k-transfer-content k-transfer-content__left"},Re=["onClick"],qe=["title"],Ee={class:"k-transfer-content k-transfer-content__right"},Le={key:0,class:"right-data-header"},$e={class:"right-data-title"},Ae={key:0,class:"column-body"},ze={class:"column-content"},Fe=["title"],Me={class:"column-operate"},je=e.defineComponent({name:"KTreeTransfer",__name:"tree_transfer",props:{modelValue:{},rowKey:{default:"id"},data:{},defaultData:{default:()=>[]},titles:{},useTree:{type:Boolean,default:!1},expandIcon:{},expandIconColor:{},collapseIcon:{},collapseIconColor:{},icon:{},iconColor:{},treeConfig:{},label:{default:"label"},scrollY:{},showDrag:{type:Boolean,default:!1},showSearchInput:{type:[Boolean,String],default:"left"},searchConfig:{},rightSearchConfig:{},showPage:{type:[Boolean,String],default:!1},leftPaginationConfig:{},rightPaginationConfig:{},columns:{},tableHeight:{default:300},checkMethod:{},checkboxAll:{type:Boolean},adaptive:{type:Boolean,default:!1}},emits:["change","drag","remote-query","server-paging","page-current-change","page-size-change","page-change","page-prev-click","page-next-click","update:modelValue"],setup(G,{expose:J,emit:W}){const{t:C}=xe.useLocale(),n=G,u=W,h=o.ref([]),f=o.ref(""),b=o.ref(""),p=o.ref(""),w=o.ref(""),y=o.ref(),_=o.ref(),X=o.ref(),Z=o.ref(),{treeConfig:D,scrollY:I}=Ve.useConfig(n),d=e.computed(()=>{const t=R.value.filter(a=>fe.value.has(a[n.rowKey]));return x.sortFunc(t,h.value,n.rowKey)}),K=e.computed(()=>{var t;return Array.isArray(n.columns)?n.columns:[{type:"checkbox",field:n.label,title:((t=n.titles)==null?void 0:t[0])??"",treeNode:n.useTree}]}),P=e.computed(()=>{var t;return B.value?n.columns.filter(a=>a.type!=="checkbox"):[{field:n.label,title:((t=n.titles)==null?void 0:t[1])??"",dragSort:!0}]}),ee=e.computed(()=>({showPage:n.showPage===!0||n.showPage==="left",paginationConfig:n.leftPaginationConfig,useTree:n.useTree,treeConfig:n.treeConfig,rowKey:n.rowKey,searchConfig:n.searchConfig})),te=e.computed(()=>({showPage:n.showPage===!0||n.showPage==="right",paginationConfig:n.rightPaginationConfig||n.leftPaginationConfig,useTree:!1,rowKey:n.rowKey,searchConfig:n.rightSearchConfig})),ne=e.computed(()=>({showPage:n.showPage===!0||n.showPage==="left",checkboxConfig:{checkAll:n.checkboxAll,checkRowKeys:n.defaultData,checkMethod:n.checkMethod},useTree:n.useTree,treeConfig:n.treeConfig,rowKey:n.rowKey})),N=e.computed(()=>{var t;return(t=y.value)==null?void 0:t.tableInstance}),ae=e.computed(()=>{var t;return(t=_.value)==null?void 0:t.tableInstance}),{visibleData:R,showTableData:q,dataLength:oe,isPaging:le,tableCacheData:re,paginationConfig:se}=H.useData(N,ee,u,K,h,f),{showTableData:E,dataLength:ie,isPaging:ce,paginationConfig:ue}=H.useData(ae,te,u,P,d,p),{checkedLeafData:fe,_checkboxMethods:k,init:de,resetCheckboxStatus:T,checkboxAllChange:ge,checkBoxChange:he}=Se.useCheckbox(N,ne,h,q,re),B=e.computed(()=>Array.isArray(n.columns)),L=e.computed(()=>function(t){var i;const a=(i=y.value)==null?void 0:i.tableInstance.isTreeExpandByRow(t),s=!(t.children&&t.children.length);if(s&&t.nodeType===1)return{icon:m(n.collapseIcon,t),color:n.collapseIconColor};if(n.icon&&s)return{icon:m(n.icon,t),color:n.iconColor};if(n.expandIcon&&a&&!s)return{icon:m(n.expandIcon,t),color:n.expandIconColor};if(n.collapseIcon&&!a&&!s)return{icon:m(n.collapseIcon,t),color:n.collapseIconColor}}),pe=e.computed(()=>t=>$(t)),me=e.computed(()=>function(t){let a=t;for(;a.pid;){const l=h.value.find(r=>r.id===a.pid);if(l)a=l;else break}const s=a.name;return{data:t[n.label],name:s}});e.watch(()=>n.data,t=>{h.value=Array.isArray(t)?[...t]:[]},{immediate:!0}),e.watch(()=>d.value,(t,a=[])=>{const s=t.map(l=>l[n.rowKey]),i=a.map(l=>l[n.rowKey]);s.join()!==i.join()&&u("update:modelValue",s)},{immediate:!0}),e.watch(()=>n.modelValue,async t=>{if(!Array.isArray(t))return;await e.nextTick(),T();const a=d.value.map(l=>l[n.rowKey]);if(t.join()===a.join())return;const s=new Set(t),i=R.value.filter(l=>s.has(l[n.rowKey]));de(i)},{immediate:!0,deep:!0});function $(t){if(!n.useTree)return 0;const{parentField:a,rowField:s}=ye();if(!t[a])return 0;const i=n.data.find(l=>l[s]===t[a]);return i?1+$(i):0}function ye(){var s,i;const t=((s=D.value)==null?void 0:s.parentField)||"pid",a=((i=D.value)==null?void 0:i.rowField)||"id";return{parentField:t,rowField:a}}function ke(t,a){n.useTree&&!be(t)&&(a.stopPropagation(),y.value.tableInstance.toggleTreeExpand(t))}function ve(){const a=_.value.tableInstance.getTableData().fullData.map(s=>s[n.rowKey]);h.value=x.sortBySmallerList(h.value,a),u("drag",d.value),u("change",d.value)}function m(t,a){return typeof t=="function"?t==null?void 0:t(a):t}function Ce(t){var s;const{row:a}=t;return((s=n.checkMethod)==null?void 0:s.call(n,t))??!a.disabled??!0}function be(t){return!t.children||t.children.length===0}function we(t){k.setCheckboxRow(t,!1),u("change",d.value)}function A(){f.value=b.value,T()}function z(){p.value=w.value}function _e(){return n.showSearchInput===!0?[f.value,p.value]:n.showSearchInput==="left"?f.value:p.value}function De(t){t==="left"?f.value="":(t==="right"||(f.value=""),p.value="")}function Te(){d.value.length!==0&&(F(),u("change",[]))}function F(t=!1){if(!t){k.setCheckboxRow(E.value,!1);return}k.setAllCheckboxRow(!1)}const M=o.ref(1);return J({clearData:F,clearQuery:De,getQuery:_e,...k}),(t,a)=>{var s,i;return e.openBlock(),e.createElementBlock("div",{class:c.normalizeClass(["k-tree-transfer",{"h-full":t.adaptive}])},[t.showSearchInput===!0||t.showSearchInput==="left"?(e.openBlock(),e.createElementBlock("div",Ke,[e.createElementVNode("div",Pe,[e.createVNode(o.unref(V.KInput),{ref_key:"KTransferInputLeftRef",ref:X,modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=l=>b.value=l),class:"flex-1",placeholder:(s=o.unref(C))==null?void 0:s("treeTransfer.enterInputSearch"),"suffix-icon":o.unref(O.default),onKeyup:Y.withKeys(A,["enter"]),onChange:A},null,8,["modelValue","placeholder","suffix-icon"]),t.showSearchInput===!0?(e.openBlock(),e.createBlock(o.unref(V.KInput),{key:0,ref_key:"KTransferInputRightRef",ref:Z,modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=l=>w.value=l),class:"flex-1 ml-[10px]",placeholder:(i=o.unref(C))==null?void 0:i("treeTransfer.enterInputSearch"),"suffix-icon":o.unref(O.default),onKeyup:Y.withKeys(z,["enter"]),onChange:z},null,8,["modelValue","placeholder","suffix-icon"])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:c.normalizeClass(["k-transfer__body",{"flex-1":t.adaptive}])},[e.createElementVNode("div",Ne,[e.createElementVNode("div",{class:c.normalizeClass(["k-transfer__list",t.useTree?"transfer-tree-table":""]),style:c.normalizeStyle({height:t.adaptive?"100%":t.tableHeight+"px"})},[e.createVNode(o.unref(v.KTable),{ref_key:"treeLeftRef",ref:y,size:"mini",border:!1,height:"100%",data:o.unref(q),"tree-config":o.unref(D),"row-config":{keyField:t.rowKey},"scroll-y":o.unref(I),"checkbox-config":{checkRowKeys:t.defaultData,trigger:"cell",checkMethod:Ce},onCheckboxChange:a[2]||(a[2]=l=>{o.unref(he)(l),u("change",d.value)}),onCheckboxAll:a[3]||(a[3]=l=>{o.unref(ge)(l),u("change",d.value)})},e.createSlots({default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(K.value,l=>(e.openBlock(),e.createBlock(o.unref(v.KTableColumn),c.normalizeProps(e.mergeProps({key:l.field},l)),{default:e.withCtx(({row:r,column:g})=>[e.renderSlot(t.$slots,"left-cell",{row:r,column:g},()=>{var S,j,Q;return[e.createElementVNode("span",{class:c.normalizeClass(["tree-transfer__cell",{"list-item-disabled":r.disabled}]),style:c.normalizeStyle({marginLeft:`${pe.value(r)*(((S=n.treeConfig)==null?void 0:S.indent)??12)}px`}),onClick:Be=>ke(r,Be)},[(e.openBlock(),e.createBlock(e.resolveDynamicComponent((j=L.value(r))==null?void 0:j.icon),{class:"column-icon",color:(Q=L.value(r))==null?void 0:Q.color},null,8,["color"])),l.field?(e.openBlock(),e.createElementBlock("span",{key:0,class:"tree-transfer__cell-label",title:r[l.field]},c.toDisplayString(r[l.field]),9,qe)):e.createCommentVNode("",!0)],14,Re)]})]),_:2},1040))),128))]),_:2},[t.$slots.empty&&f.value?{name:"empty",fn:e.withCtx(()=>[e.renderSlot(t.$slots,"empty",{query:f.value})]),key:"0"}:void 0]),1032,["data","tree-config","row-config","scroll-y","checkbox-config"])],6),e.createVNode(U.default,{visible:o.unref(le),position:"left",emits:u,"data-length":o.unref(oe),"page-config":o.unref(se),"reset-checkbox-status":o.unref(T)},{default:e.withCtx(({pageConfig:l})=>[e.createVNode(o.unref(V.KInput),{modelValue:M.value,"onUpdate:modelValue":a[4]||(a[4]=r=>M.value=r),onChange:r=>l.currentPage=r},null,8,["modelValue","onChange"])]),_:1},8,["visible","data-length","page-config","reset-checkbox-status"])]),e.createElementVNode("div",Ee,[e.createElementVNode("div",{class:"k-transfer__list",style:c.normalizeStyle({height:t.adaptive?"100%":t.tableHeight+"px"})},[e.createVNode(o.unref(v.KTable),{ref_key:"tableRightRef",ref:_,size:"mini",border:!1,height:"100%",data:o.unref(E),"row-config":{useKey:!0,drag:t.showDrag},"scroll-y":o.unref(I),onRowDragend:ve},e.createSlots({default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(P.value,l=>(e.openBlock(),e.createBlock(o.unref(v.KTableColumn),c.normalizeProps(e.mergeProps({key:l.field},l)),{header:e.withCtx(r=>[e.renderSlot(t.$slots,o.unref(x.compatibleSlots)(t.$slots,["right-header","rightHeader"]),c.normalizeProps(e.guardReactiveProps(r)),()=>{var g;return[B.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createTextVNode(c.toDisplayString(l.title??""),1)],64)):(e.openBlock(),e.createElementBlock("div",Le,[e.createElementVNode("span",$e,c.toDisplayString(l.title??""),1),e.createElementVNode("span",{class:"clear-data",onClick:Te},c.toDisplayString((g=o.unref(C))==null?void 0:g("treeTransfer.clearData")),1)]))]})]),default:e.withCtx(({row:r,column:g})=>[B.value?e.renderSlot(t.$slots,"right-cell",{key:1,row:r,column:g},()=>[e.createTextVNode(c.toDisplayString(r[l.field??""]),1)]):(e.openBlock(),e.createElementBlock("div",Ae,[e.createElementVNode("span",ze,[e.renderSlot(t.$slots,"right-cell",{row:r,column:g},()=>[n.icon?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(m(n.icon,r)),{key:0,class:"column-icon"})):e.createCommentVNode("",!0),e.createElementVNode("span",{class:"tree-transfer__cell-label",title:r[n.label]},[e.renderSlot(t.$slots,"right-label",{row:r,column:g,parentData:me.value(r)},()=>[e.createTextVNode(c.toDisplayString(r[n.label]),1)])],8,Fe)])]),e.createElementVNode("div",Me,[e.createVNode(o.unref(Ie.default),{class:"column-close",onClick:S=>we(r)},null,8,["onClick"])])]))]),_:2},1040))),128))]),_:2},[t.$slots.empty&&f.value?{name:"empty",fn:e.withCtx(()=>[e.renderSlot(t.$slots,"empty",{query:f.value})]),key:"0"}:void 0]),1032,["data","row-config","scroll-y"])],4),e.createVNode(U.default,{visible:o.unref(ce),position:"right",emits:u,"data-length":o.unref(ie),"page-config":o.unref(ue)},null,8,["visible","data-length","page-config"])])],2)],2)}}});exports.default=je;
