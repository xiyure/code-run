"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),y=require("../table/index.cjs"),S=require("../input/index.cjs"),V=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const _e=require("./hooks/use_checkbox.cjs"),j=require("./hooks/use_data.cjs"),De=require("./hooks/use_config.cjs"),Se=require("../../hooks/use_locale.cjs"),Q=require("./page.vue.cjs");;/* empty css            */const H=require("../../node_modules/ksw-vue-icon/es/icons/base/search.cjs"),Ve=require("../../node_modules/ksw-vue-icon/es/icons/base/close.cjs"),xe={key:0,class:"k-transfer__filter !mb-3"},Ie={class:"flex justify-between items-center gap-2"},Be={class:"k-transfer-content k-transfer-content__left"},Ke=["onClick"],Pe=["title"],Ne={class:"k-transfer-content k-transfer-content__right"},Re={key:0,class:"right-data-header"},Ee={class:"right-data-title"},Le={key:0,class:"column-body"},qe={class:"column-content"},$e=["title"],Ae={class:"column-operate"},ze=e.defineComponent({name:"KTreeTransfer",__name:"tree_transfer",props:{modelValue:{},rowKey:{default:"id"},data:{},defaultData:{default:()=>[]},titles:{},useTree:{type:Boolean,default:!1},expandIcon:{},expandIconColor:{},collapseIcon:{},collapseIconColor:{},icon:{},iconColor:{},treeConfig:{},label:{default:"label"},scrollY:{},showDrag:{type:Boolean,default:!1},showSearchInput:{type:[Boolean,String],default:"left"},searchConfig:{},rightSearchConfig:{},showPage:{type:[Boolean,String],default:!1},leftPaginationConfig:{},rightPaginationConfig:{},columns:{},tableHeight:{default:300},checkMethod:{},checkboxAll:{type:Boolean},adaptive:{type:Boolean,default:!1}},emits:["change","drag","remote-query","server-paging","page-current-change","page-size-change","page-change","page-prev-click","page-next-click","update:modelValue"],setup(U,{expose:Y,emit:O}){const{t:k}=Se.useLocale(),a=U,i=O,d=e.ref([]),c=e.ref(""),v=e.ref(""),g=e.ref(""),C=e.ref(""),p=e.ref(),b=e.ref(),G=e.ref(),J=e.ref(),{treeConfig:w,scrollY:x}=De.useConfig(a),u=e.computed(()=>{const t=P.value.filter(n=>ie.value.has(n[a.rowKey]));return V.sortFunc(t,d.value,a.rowKey)}),I=e.computed(()=>{var t;return Array.isArray(a.columns)?a.columns:[{type:"checkbox",field:a.label,title:((t=a.titles)==null?void 0:t[0])??"",treeNode:a.useTree}]}),B=e.computed(()=>{var t;return _.value?a.columns.filter(n=>n.type!=="checkbox"):[{field:a.label,title:((t=a.titles)==null?void 0:t[1])??"",dragSort:!0}]}),W=e.computed(()=>({showPage:a.showPage===!0||a.showPage==="left",paginationConfig:a.leftPaginationConfig,useTree:a.useTree,treeConfig:a.treeConfig,rowKey:a.rowKey,searchConfig:a.searchConfig})),X=e.computed(()=>({showPage:a.showPage===!0||a.showPage==="right",paginationConfig:a.rightPaginationConfig||a.leftPaginationConfig,useTree:!1,rowKey:a.rowKey,searchConfig:a.rightSearchConfig})),Z=e.computed(()=>({showPage:a.showPage===!0||a.showPage==="left",checkboxConfig:{checkAll:a.checkboxAll,checkRowKeys:a.defaultData,checkMethod:a.checkMethod},useTree:a.useTree,treeConfig:a.treeConfig,rowKey:a.rowKey})),K=e.computed(()=>{var t;return(t=p.value)==null?void 0:t.tableInstance}),ee=e.computed(()=>{var t;return(t=b.value)==null?void 0:t.tableInstance}),{visibleData:P,showTableData:N,dataLength:te,isPaging:ae,tableCacheData:ne,paginationConfig:oe}=j.useData(K,W,i,I,d,c),{showTableData:R,dataLength:le,isPaging:re,paginationConfig:se}=j.useData(ee,X,i,B,u,g),{checkedLeafData:ie,_checkboxMethods:m,init:ce,resetCheckboxStatus:T,checkboxAllChange:ue,checkBoxChange:fe}=_e.useCheckbox(K,Z,d,N,ne),_=e.computed(()=>Array.isArray(a.columns)),E=e.computed(()=>function(t){var s;const n=(s=p.value)==null?void 0:s.tableInstance.isTreeExpandByRow(t),r=!(t.children&&t.children.length);if(r&&t.nodeType===1)return{icon:h(a.collapseIcon,t),color:a.collapseIconColor};if(a.icon&&r)return{icon:h(a.icon,t),color:a.iconColor};if(a.expandIcon&&n&&!r)return{icon:h(a.expandIcon,t),color:a.expandIconColor};if(a.collapseIcon&&!n&&!r)return{icon:h(a.collapseIcon,t),color:a.collapseIconColor}}),de=e.computed(()=>t=>L(t)),ge=e.computed(()=>function(t){let n=t;for(;n.pid;){const o=d.value.find(l=>l.id===n.pid);if(o)n=o;else break}const r=n.name;return{data:t[a.label],name:r}});e.watch(()=>a.data,t=>{d.value=Array.isArray(t)?[...t]:[]},{immediate:!0}),e.watch(()=>u.value,(t,n=[])=>{const r=t.map(o=>o[a.rowKey]),s=n.map(o=>o[a.rowKey]);r.join()!==s.join()&&i("update:modelValue",r)},{immediate:!0}),e.watch(()=>a.modelValue,async t=>{if(!Array.isArray(t))return;await e.nextTick(),T();const n=u.value.map(o=>o[a.rowKey]);if(t.join()===n.join())return;const r=new Set(t),s=P.value.filter(o=>r.has(o[a.rowKey]));ce(s)},{immediate:!0,deep:!0});function L(t){if(!a.useTree)return 0;const{parentField:n,rowField:r}=he();if(!t[n])return 0;const s=a.data.find(o=>o[r]===t[n]);return s?1+L(s):0}function he(){var r,s;const t=((r=w.value)==null?void 0:r.parentField)||"pid",n=((s=w.value)==null?void 0:s.rowField)||"id";return{parentField:t,rowField:n}}function pe(t,n){a.useTree&&!ke(t)&&(n.stopPropagation(),p.value.tableInstance.toggleTreeExpand(t))}function me(){const n=b.value.tableInstance.getTableData().fullData.map(r=>r[a.rowKey]);d.value=V.sortBySmallerList(d.value,n),i("drag",u.value),i("change",u.value)}function h(t,n){return typeof t=="function"?t==null?void 0:t(n):t}function ye(t){var r;const{row:n}=t;return((r=a.checkMethod)==null?void 0:r.call(a,t))??!n.disabled??!0}function ke(t){return!t.children||t.children.length===0}function ve(t){m.setCheckboxRow(t,!1),i("change",u.value)}function q(){c.value=v.value,T()}function $(){g.value=C.value}function Ce(){return a.showSearchInput===!0?[c.value,g.value]:a.showSearchInput==="left"?c.value:g.value}function be(t){t==="left"?c.value="":(t==="right"||(c.value=""),g.value="")}function we(){u.value.length!==0&&(A(),i("change",[]))}function A(t=!1){if(!t){m.setCheckboxRow(R.value,!1);return}m.setAllCheckboxRow(!1)}const z=e.ref(1);return Y({clearData:A,clearQuery:be,getQuery:Ce,...m}),(t,n)=>{var r,s;return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["k-tree-transfer",{"h-full":t.adaptive}])},[t.showSearchInput===!0||t.showSearchInput==="left"?(e.openBlock(),e.createElementBlock("div",xe,[e.createElementVNode("div",Ie,[e.createVNode(e.unref(S.KInput),{ref_key:"KTransferInputLeftRef",ref:G,modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=o=>v.value=o),class:"flex-1",placeholder:(r=e.unref(k))==null?void 0:r("treeTransfer.enterInputSearch"),"suffix-icon":e.unref(H.default),onKeyup:e.withKeys(q,["enter"]),onChange:q},null,8,["modelValue","placeholder","suffix-icon"]),t.showSearchInput===!0?(e.openBlock(),e.createBlock(e.unref(S.KInput),{key:0,ref_key:"KTransferInputRightRef",ref:J,modelValue:C.value,"onUpdate:modelValue":n[1]||(n[1]=o=>C.value=o),class:"flex-1 ml-[10px]",placeholder:(s=e.unref(k))==null?void 0:s("treeTransfer.enterInputSearch"),"suffix-icon":e.unref(H.default),onKeyup:e.withKeys($,["enter"]),onChange:$},null,8,["modelValue","placeholder","suffix-icon"])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["k-transfer__body",{"flex-1":t.adaptive}])},[e.createElementVNode("div",Be,[e.createElementVNode("div",{class:e.normalizeClass(["k-transfer__list",t.useTree?"transfer-tree-table":""]),style:e.normalizeStyle({height:t.adaptive?"100%":t.tableHeight+"px"})},[e.createVNode(e.unref(y.KTable),{ref_key:"treeLeftRef",ref:p,size:"mini",border:!1,height:"100%",data:e.unref(N),"tree-config":e.unref(w),"row-config":{keyField:t.rowKey},"scroll-y":e.unref(x),"checkbox-config":{checkRowKeys:t.defaultData,trigger:"cell",checkMethod:ye},onCheckboxChange:n[2]||(n[2]=o=>{e.unref(fe)(o),i("change",u.value)}),onCheckboxAll:n[3]||(n[3]=o=>{e.unref(ue)(o),i("change",u.value)})},e.createSlots({default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.value,o=>(e.openBlock(),e.createBlock(e.unref(y.KTableColumn),e.normalizeProps(e.mergeProps({key:o.field},o)),{default:e.withCtx(({row:l,column:f})=>[e.renderSlot(t.$slots,"left-cell",{row:l,column:f},()=>{var D,F,M;return[e.createElementVNode("span",{class:e.normalizeClass(["tree-transfer__cell",{"list-item-disabled":l.disabled}]),style:e.normalizeStyle({marginLeft:`${de.value(l)*(((D=a.treeConfig)==null?void 0:D.indent)??12)}px`}),onClick:Te=>pe(l,Te)},[(e.openBlock(),e.createBlock(e.resolveDynamicComponent((F=E.value(l))==null?void 0:F.icon),{class:"column-icon",color:(M=E.value(l))==null?void 0:M.color},null,8,["color"])),o.field?(e.openBlock(),e.createElementBlock("span",{key:0,class:"tree-transfer__cell-label",title:l[o.field]},e.toDisplayString(l[o.field]),9,Pe)):e.createCommentVNode("",!0)],14,Ke)]})]),_:2},1040))),128))]),_:2},[t.$slots.empty&&c.value?{name:"empty",fn:e.withCtx(()=>[e.renderSlot(t.$slots,"empty",{query:c.value})]),key:"0"}:void 0]),1032,["data","tree-config","row-config","scroll-y","checkbox-config"])],6),e.createVNode(Q.default,{visible:e.unref(ae),position:"left",emits:i,"data-length":e.unref(te),"page-config":e.unref(oe),"reset-checkbox-status":e.unref(T)},{default:e.withCtx(({pageConfig:o})=>[e.createVNode(e.unref(S.KInput),{modelValue:z.value,"onUpdate:modelValue":n[4]||(n[4]=l=>z.value=l),onChange:l=>o.currentPage=l},null,8,["modelValue","onChange"])]),_:1},8,["visible","data-length","page-config","reset-checkbox-status"])]),e.createElementVNode("div",Ne,[e.createElementVNode("div",{class:"k-transfer__list",style:e.normalizeStyle({height:t.adaptive?"100%":t.tableHeight+"px"})},[e.createVNode(e.unref(y.KTable),{ref_key:"tableRightRef",ref:b,size:"mini",border:!1,height:"100%",data:e.unref(R),"row-config":{useKey:!0,drag:t.showDrag},"scroll-y":e.unref(x),onRowDragend:me},e.createSlots({default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value,o=>(e.openBlock(),e.createBlock(e.unref(y.KTableColumn),e.normalizeProps(e.mergeProps({key:o.field},o)),{header:e.withCtx(l=>[e.renderSlot(t.$slots,e.unref(V.compatibleSlots)(t.$slots,["right-header","rightHeader"]),e.normalizeProps(e.guardReactiveProps(l)),()=>{var f;return[_.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createTextVNode(e.toDisplayString(o.title??""),1)],64)):(e.openBlock(),e.createElementBlock("div",Re,[e.createElementVNode("span",Ee,e.toDisplayString(o.title??""),1),e.createElementVNode("span",{class:"clear-data",onClick:we},e.toDisplayString((f=e.unref(k))==null?void 0:f("treeTransfer.clearData")),1)]))]})]),default:e.withCtx(({row:l,column:f})=>[_.value?e.renderSlot(t.$slots,"right-cell",{key:1,row:l,column:f},()=>[e.createTextVNode(e.toDisplayString(l[o.field??""]),1)]):(e.openBlock(),e.createElementBlock("div",Le,[e.createElementVNode("span",qe,[e.renderSlot(t.$slots,"right-cell",{row:l,column:f},()=>[a.icon?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(h(a.icon,l)),{key:0,class:"column-icon"})):e.createCommentVNode("",!0),e.createElementVNode("span",{class:"tree-transfer__cell-label",title:l[a.label]},[e.renderSlot(t.$slots,"right-label",{row:l,column:f,parentData:ge.value(l)},()=>[e.createTextVNode(e.toDisplayString(l[a.label]),1)])],8,$e)])]),e.createElementVNode("div",Ae,[e.createVNode(e.unref(Ve.default),{class:"column-close",onClick:D=>ve(l)},null,8,["onClick"])])]))]),_:2},1040))),128))]),_:2},[t.$slots.empty&&c.value?{name:"empty",fn:e.withCtx(()=>[e.renderSlot(t.$slots,"empty",{query:c.value})]),key:"0"}:void 0]),1032,["data","row-config","scroll-y"])],4),e.createVNode(Q.default,{visible:e.unref(re),position:"right",emits:i,"data-length":e.unref(le),"page-config":e.unref(se)},null,8,["visible","data-length","page-config"])])],2)],2)}}});exports.default=ze;
