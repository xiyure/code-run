"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),N=require("../../hooks/use_locale.cjs"),K=require("../../utils/constructor/sortable.cjs"),M=require("../input/index.cjs"),k=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/culori/src/index.cjs");const D=require("../../node_modules/ksw-vue-icon/es/icons/base/search.cjs"),I=require("../../node_modules/element-plus/es/components/transfer/index.cjs"),P={class:"k-transfer_searcher"},z={class:"k-transfer-item"},H={class:"k-transfer-label"},O=e.defineComponent({name:"KTransfer",__name:"transfer",props:{modelValue:{},data:{},filterablePlaceholder:{},props:{},defaultKeys:{},filterable:{type:Boolean,default:!0},searchStrictly:{type:Boolean},drag:{type:Boolean},dragIcon:{}},emits:["update:modelValue","change","left-check-change","right-check-change","input","reset","drag"],setup(C,{expose:b,emit:w}){const o=C,s=w,_=e.inject("_styleModule",""),{t:f}=N.useLocale(),l=e.ref([]),m=e.ref(""),u=e.ref([]),c=e.ref();let p=[];e.onMounted(()=>{V(),E()}),e.onUnmounted(()=>{v==null||v.destroy()});const h=e.computed(()=>({label:"label",key:"key",disabled:"disabled",...o.props})),S=e.computed(()=>o.filterablePlaceholder??(f==null?void 0:f("transfer.searchHeaderName")));e.watch(()=>o.modelValue,t=>{if(!t||!Array.isArray(t)){l.value=[];return}JSON.stringify(t)!==JSON.stringify(l.value)&&(l.value=t)},{immediate:!0}),e.watch(()=>o.data,t=>{if(Array.isArray(t)){u.value=t,p=u.value.map(r=>r[h.value.key]);return}u.value=[],p.length=0},{immediate:!0}),e.watch(()=>m.value,t=>{const r=c.value.$el.querySelectorAll(".el-input__inner");if(!(!r||!r.length))for(let a=0;a<r.length;a++){r[a].value=t;const n=new Event("input",{bubbles:!0});r[a].dispatchEvent(n)}});function L(t,r,a){if(s("update:modelValue",l.value),s("change",t,r,a),l.value.length===0){const n=c.value.$el.querySelectorAll(".el-transfer-panel__list")[1],d=(n==null?void 0:n.children)??[];for(let i=0;i<d.length;i++)d[i].tagName.toLocaleUpperCase()==="LABEL"&&(n.removeChild(d[i]),i--)}}function A(t,r){s("left-check-change",t,r)}function B(t,r){s("right-check-change",t,r)}function V(){if(!c.value)return;const t=c.value.$el,r=t.querySelectorAll(".el-transfer-panel__header")[1];r.classList.add("transfer-right-header");const a=document.createElement("label");a.innerHTML=f==null?void 0:f("transfer.reset"),a.classList.add("transfer-restore__text"),a.addEventListener("click",()=>{q()}),r.appendChild(a);const n=t.querySelectorAll(".el-transfer__button");n[1].innerHTML='<span class="ksw-icon ksw-icon-ArrowToRight"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="m18.397 12-6.91 6.976a.58.58 0 0 0-.173.409c0 .34.307.615.686.615a.72.72 0 0 0 .513-.207l7.314-7.384a.57.57 0 0 0 0-.818l-7.314-7.384A.72.72 0 0 0 12 4c-.379 0-.686.276-.686.615 0 .151.062.297.173.41z"></path><path fill-rule="evenodd" d="m11.083 12-6.91 6.976a.58.58 0 0 0-.173.409c0 .34.307.615.686.615a.72.72 0 0 0 .512-.207l7.315-7.384a.57.57 0 0 0 0-.818L5.199 4.207A.72.72 0 0 0 4.686 4C4.307 4 4 4.276 4 4.615c0 .151.062.297.173.41z"></path></svg></span>',n[0].innerHTML='<span class="ksw-icon ksw-icon-ArrowToLeft"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="m5.477 12 6.363-6.976a.6.6 0 0 0 .16-.409.624.624 0 0 0-.632-.615.64.64 0 0 0-.472.207L4.16 11.59a.604.604 0 0 0 0 .818l6.736 7.384a.64.64 0 0 0 .472.207.624.624 0 0 0 .632-.615.6.6 0 0 0-.16-.41z"></path><path fill-rule="evenodd" d="m13.477 12 6.363-6.976a.6.6 0 0 0 .16-.409.624.624 0 0 0-.632-.615.64.64 0 0 0-.472.207L12.16 11.59a.604.604 0 0 0 0 .818l6.736 7.384a.64.64 0 0 0 .472.207.624.624 0 0 0 .632-.615.6.6 0 0 0-.16-.41z"></path></svg></span>'}function q(){if(!Array.isArray(o.defaultKeys)){s("update:modelValue",[]);return}const{key:t}=h.value;u.value.sort((r,a)=>p.indexOf(r[t])-p.indexOf(a[t])),s("update:modelValue",[...o.defaultKeys]),s("reset",[...o.defaultKeys])}let v=null;function E(){var r,a;if(!o.drag)return;const t=(a=(r=c.value.$el)==null?void 0:r.querySelectorAll(".el-transfer-panel__list"))==null?void 0:a[1];t&&(v=K.Sortable(t,{handle:".k-transfer-sort",animation:150,onEnd:n=>{var y;const{newIndex:d,oldIndex:i}=n;if(d===i||d===void 0||i===void 0)return;const g=l.value.splice(i,1)[0];g&&(l.value.splice(d,0,g),l.value=[...l.value],u.value=k.sortBySmallerList(u.value,l.value,((y=o.props)==null?void 0:y.key)??"key"),s("update:modelValue",l.value),s("drag",u.value))}}))}function x(){return{sourceData:u.value,selectData:l.value}}const T={getTransferData:x};return b(k.getExposeProxy(T,c)),(t,r)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["k-transfer",e.unref(_)])},[e.createElementVNode("div",P,[t.filterable&&!t.searchStrictly?(e.openBlock(),e.createBlock(e.unref(M.KInput),{key:0,modelValue:m.value,"onUpdate:modelValue":r[0]||(r[0]=a=>m.value=a),placeholder:S.value,"prefix-icon":e.unref(D.default)},null,8,["modelValue","placeholder","prefix-icon"])):e.createCommentVNode("",!0)]),e.createVNode(e.unref(I.ElTransfer),e.mergeProps({ref_key:"KTransferRef",ref:c,modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=a=>l.value=a)},t.$attrs,{data:u.value,props:o.props,class:{"k-transfer_search-strictly":!t.searchStrictly},filterable:"",onChange:L,onLeftCheckChange:A,onRightCheckChange:B}),{default:e.withCtx(({option:a})=>[e.createElementVNode("div",z,[e.createElementVNode("span",H,e.toDisplayString(a[h.value.label]),1),t.drag&&l.value.includes(a[h.value.key])?(e.openBlock(),e.createElementBlock("span",{key:0,class:"k-transfer-sort",onClick:r[1]||(r[1]=e.withModifiers(()=>{},["prevent"]))},[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.dragIcon??"IconDrag")))])):e.createCommentVNode("",!0)])]),_:1},16,["modelValue","data","props","class"])],2))}});exports.default=O;
