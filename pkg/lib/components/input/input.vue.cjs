"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),D=require("../popover/index.cjs"),O=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const $=require("../../hooks/use_size.cjs"),R=require("../../hooks/use_locale.cjs"),K=require("../../hooks/use_cursor.cjs"),U=require("../../node_modules/element-plus/es/components/input/index.cjs"),W=require("../../node_modules/ksw-vue-icon/es/icons/base/down.cjs"),j=require("../../node_modules/ksw-vue-icon/es/icons/base/eye-off.cjs"),A=require("../../node_modules/ksw-vue-icon/es/icons/base/eye.cjs"),H=require("../../node_modules/element-plus/es/components/scrollbar/index.cjs"),F=["onClick"],Y={class:"k-input-options-empty"},Z=e.defineComponent({name:"KInput",__name:"input",props:{modelValue:{default:""},placeholder:{},size:{},iconLeft:{default:void 0},iconRight:{default:void 0},prefixIcon:{default:void 0},suffixIcon:{default:void 0},showPassword:{type:Boolean,default:!1},type:{default:"text"},selectable:{type:Boolean,default:!1},filterable:{type:Boolean},options:{default:()=>[]},popperClass:{default:""},popperStyle:{default:()=>({})},teleported:{type:Boolean,default:!0}},emits:["update:modelValue","input","change","popper-show","popper-hide"],setup(b,{expose:q,emit:z}){const n=b,i=e.ref(),w=$.useSize(n),{recordCursor:x,setCursor:L}=K.useCursor(i),{t:h}=R.useLocale(),a=z,p=e.ref(!1),r=e.ref(""),k=e.ref(0),s=e.ref(!1),c=e.ref(""),v=e.ref(!1),u=e.ref(-1);e.onMounted(()=>{window.addEventListener("click",E),window.addEventListener("resize",m),window.addEventListener("keydown",B),m()}),e.onBeforeUnmount(()=>{window.removeEventListener("click",E),window.removeEventListener("resize",m),window.removeEventListener("keydown",B)});const y=e.computed(()=>n.type!=="password"&&(!n.showPassword||p.value)?n.type:p.value?"text":"password"),g=e.computed(()=>n.selectable&&y.value==="text"&&!n.showPassword),d=e.computed(()=>{var t;return n.filterable&&!v.value&&r.value?(t=n.options)==null?void 0:t.filter(o=>o.toString().includes(r.value.toString())):n.options});e.watch(()=>n.modelValue,t=>{t!==r.value&&(r.value=t)},{immediate:!0}),e.watch(()=>s.value,t=>{t||(v.value=!1)});const C=e.computed(()=>t=>{var l;if(typeof t!="function")return"";switch(typeof((l=t())==null?void 0:l[0].type)){case"string":return"k-input-slot--htmlTag";case"object":return"k-input-slot--component";case"symbol":return"k-input-slot--string";default:return""}});function P(){x(),p.value=!p.value,setTimeout(L)}function S(t){r.value!==t&&(r.value=t,a("update:modelValue",t),a("input",t),a("change",t))}function I(){s.value||(v.value=!0),s.value=!s.value}function N(t){var o;n.filterable&&r.value&&((o=d.value)!=null&&o.length)?s.value=!0:s.value=!1,a("update:modelValue",t),a("input",t)}function B(t){var l;if(!s.value)return;const o=((l=d.value)==null?void 0:l.length)??0;t.code==="ArrowUp"?u.value=(u.value-1+o)%o:t.code==="ArrowDown"?u.value=(u.value+1)%o:t.code==="Enter"&&u.value>=0&&u.value<o&&(S(d.value[u.value]),s.value=!1)}function E(){s.value=!1}function m(){setTimeout(()=>{var t,o;return k.value=(o=(t=i.value)==null?void 0:t.$el)==null?void 0:o.offsetWidth})}e.provide($.SIZE_KEY,w);const T={};return q(O.getExposeProxy(T,i)),(t,o)=>(e.openBlock(),e.createBlock(e.unref(U.ElInput),e.mergeProps({ref_key:"inputRef",ref:i},t.$attrs,{modelValue:r.value,"onUpdate:modelValue":o[4]||(o[4]=l=>r.value=l),class:["k-input",{"k-input-has-prepend":t.$slots.prepend,"k-input-has-append":t.$slots.append}],"prefix-icon":t.iconLeft??t.prefixIcon,"suffix-icon":t.iconRight??t.suffixIcon,type:y.value,size:e.unref(w).elSize,placeholder:t.placeholder??e.unref(h)("input.placeholder"),onInput:N,onChange:o[5]||(o[5]=l=>{a("change",l)})}),e.createSlots({prefix:e.withCtx(()=>[e.renderSlot(t.$slots,"prefix")]),_:2},[t.$slots.prepend?{name:"prepend",fn:e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(C.value(t.$slots.prepend))},[e.renderSlot(t.$slots,"prepend")],2)]),key:"0"}:void 0,t.$slots.append?{name:"append",fn:e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(C.value(t.$slots.append))},[e.renderSlot(t.$slots,"append")],2)]),key:"1"}:void 0,g.value?{name:"suffix",fn:e.withCtx(()=>[e.createVNode(e.unref(W.default),{class:e.normalizeClass(["k-input__arrow",{"is-rotate":s.value}]),onClick:e.withModifiers(I,["prevent","stop"])},null,8,["class"]),g.value?(e.openBlock(),e.createBlock(e.unref(D.KPopover),{key:0,visible:s.value,"show-arrow":!1,width:k.value,"virtual-triggering":"","virtual-ref":i.value,offset:3,teleported:t.teleported,"popper-style":{padding:0,...t.popperStyle},"popper-class":`k-input__popper ${c.value} ${t.popperClass}`,onBeforeEnter:o[0]||(o[0]=()=>{c.value="k-input__popper-enter"}),onBeforeLeave:o[1]||(o[1]=()=>{c.value="k-input__popper-leave"}),onShow:o[2]||(o[2]=()=>{a("popper-show")}),onHide:o[3]||(o[3]=()=>{a("popper-hide")})},{default:e.withCtx(()=>{var l;return[e.createVNode(e.unref(H.ElScrollbar),{class:"k-input-scrollbar","max-height":((l=t.popperStyle)==null?void 0:l.maxHeight)??200},{default:e.withCtx(()=>{var V;return[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(f,M)=>(e.openBlock(),e.createElementBlock("li",{key:f,class:e.normalizeClass(["k-input-option",{"is-selected":r.value===f,"is-highlight":u.value===M}]),onClick:()=>{S(f)}},e.toDisplayString(f),11,F))),128)),(V=t.options)!=null&&V.length?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"empty",{key:0},()=>[e.createElementVNode("div",Y,e.toDisplayString(e.unref(h)("input.empty")),1)])]}),_:3},8,["max-height"])]}),_:3},8,["visible","width","virtual-ref","teleported","popper-style","popper-class"])):e.createCommentVNode("",!0)]),key:"2"}:{name:"suffix",fn:e.withCtx(()=>[e.renderSlot(t.$slots,"suffix"),t.showPassword&&r.value?(e.openBlock(),e.createElementBlock("div",{key:0,onClick:P},[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(p.value?e.unref(A.default):e.unref(j.default))))])):e.createCommentVNode("",!0)]),key:"3"}]),1040,["modelValue","class","prefix-icon","suffix-icon","type","size","placeholder"]))}});exports.default=Z;
