"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});require("../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const R=require("../popover/index.cjs"),K=require("../../utils/utils.cjs");require("../../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.cjs");require("../../node_modules/sortablejs/modular/sortable.esm.cjs");require("../../node_modules/culori/src/index.cjs");const b=require("../../hooks/use_size.cjs"),U=require("../../hooks/use_locale.cjs"),W=require("../../hooks/use_cursor.cjs"),j=require("../../node_modules/ksw-vue-icon/es/icons/base/down.cjs"),A=require("../../node_modules/ksw-vue-icon/es/icons/base/eye-off.cjs"),H=require("../../node_modules/ksw-vue-icon/es/icons/base/eye.cjs"),F=require("../../node_modules/element-plus/es/components/scrollbar/index.cjs"),Y=require("../../node_modules/element-plus/es/components/input/index.cjs"),t=require("../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs"),l=require("../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),p=require("../../node_modules/@vue/runtime-core/node_modules/@vue/shared/dist/shared.esm-bundler.cjs"),Z=require("../../node_modules/@vue/runtime-dom/dist/runtime-dom.esm-bundler.cjs"),G=["onClick"],J={class:"k-input-options-empty"},Q=t.defineComponent({name:"KInput",__name:"input",props:{modelValue:{default:""},placeholder:{},size:{},iconLeft:{default:void 0},iconRight:{default:void 0},prefixIcon:{default:void 0},suffixIcon:{default:void 0},showPassword:{type:Boolean,default:!1},type:{default:"text"},selectable:{type:Boolean,default:!1},filterable:{type:Boolean},options:{default:()=>[]},popperClass:{default:""},popperStyle:{default:()=>({})},teleported:{type:Boolean,default:!0}},emits:["update:modelValue","input","change","popper-show","popper-hide"],setup(z,{expose:x,emit:L}){const r=z,d=l.ref(),k=b.useSize(r),{recordCursor:P,setCursor:I}=W.useCursor(d),{t:y}=U.useLocale(),i=L,f=l.ref(!1),s=l.ref(""),g=l.ref(0),u=l.ref(!1),m=l.ref(""),w=l.ref(!1),a=l.ref(-1);t.onMounted(()=>{window.addEventListener("click",V),window.addEventListener("resize",h),window.addEventListener("keydown",q),h()}),t.onBeforeUnmount(()=>{window.removeEventListener("click",V),window.removeEventListener("resize",h),window.removeEventListener("keydown",q)});const C=t.computed(()=>r.type!=="password"&&(!r.showPassword||f.value)?r.type:f.value?"text":"password"),B=t.computed(()=>r.selectable&&C.value==="text"&&!r.showPassword),c=t.computed(()=>{var e;return r.filterable&&!w.value&&s.value?(e=r.options)==null?void 0:e.filter(o=>o.toString().includes(s.value.toString())):r.options});t.watch(()=>r.modelValue,e=>{e!==s.value&&(s.value=e)},{immediate:!0}),t.watch(()=>u.value,e=>{e||(w.value=!1)});const S=t.computed(()=>e=>{var n;if(typeof e!="function")return"";switch(typeof((n=e())==null?void 0:n[0].type)){case"string":return"k-input-slot--htmlTag";case"object":return"k-input-slot--component";case"symbol":return"k-input-slot--string";default:return""}});function N(){P(),f.value=!f.value,setTimeout(I)}function E(e){s.value!==e&&(s.value=e,i("update:modelValue",e),i("input",e),i("change",e))}function T(){u.value||(w.value=!0),u.value=!u.value}function D(e){var o;r.filterable&&s.value&&((o=c.value)!=null&&o.length)?u.value=!0:u.value=!1,i("update:modelValue",e),i("input",e)}function q(e){var n;if(!u.value)return;const o=((n=c.value)==null?void 0:n.length)??0;e.code==="ArrowUp"?a.value=(a.value-1+o)%o:e.code==="ArrowDown"?a.value=(a.value+1)%o:e.code==="Enter"&&a.value>=0&&a.value<o&&(E(c.value[a.value]),u.value=!1)}function V(){u.value=!1}function h(){setTimeout(()=>{var e,o;return g.value=(o=(e=d.value)==null?void 0:e.$el)==null?void 0:o.offsetWidth})}t.provide(b.SIZE_KEY,k);const M={};return x(K.getExposeProxy(M,d)),(e,o)=>(t.openBlock(),t.createBlock(l.unref(Y.ElInput),t.mergeProps({ref_key:"inputRef",ref:d},e.$attrs,{modelValue:s.value,"onUpdate:modelValue":o[4]||(o[4]=n=>s.value=n),class:["k-input",{"k-input-has-prepend":e.$slots.prepend,"k-input-has-append":e.$slots.append}],"prefix-icon":e.iconLeft??e.prefixIcon,"suffix-icon":e.iconRight??e.suffixIcon,type:C.value,size:l.unref(k).elSize,placeholder:e.placeholder??l.unref(y)("input.placeholder"),onInput:D,onChange:o[5]||(o[5]=n=>{i("change",n)})}),t.createSlots({prefix:t.withCtx(()=>[t.renderSlot(e.$slots,"prefix")]),_:2},[e.$slots.prepend?{name:"prepend",fn:t.withCtx(()=>[t.createElementVNode("div",{class:p.normalizeClass(S.value(e.$slots.prepend))},[t.renderSlot(e.$slots,"prepend")],2)]),key:"0"}:void 0,e.$slots.append?{name:"append",fn:t.withCtx(()=>[t.createElementVNode("div",{class:p.normalizeClass(S.value(e.$slots.append))},[t.renderSlot(e.$slots,"append")],2)]),key:"1"}:void 0,B.value?{name:"suffix",fn:t.withCtx(()=>[t.createVNode(l.unref(j.default),{class:p.normalizeClass(["k-input__arrow",{"is-rotate":u.value}]),onClick:Z.withModifiers(T,["prevent","stop"])},null,8,["class"]),B.value?(t.openBlock(),t.createBlock(l.unref(R.KPopover),{key:0,visible:u.value,"show-arrow":!1,width:g.value,"virtual-triggering":"","virtual-ref":d.value,offset:3,teleported:e.teleported,"popper-style":{padding:0,...e.popperStyle},"popper-class":`k-input__popper ${m.value} ${e.popperClass}`,onBeforeEnter:o[0]||(o[0]=()=>{m.value="k-input__popper-enter"}),onBeforeLeave:o[1]||(o[1]=()=>{m.value="k-input__popper-leave"}),onShow:o[2]||(o[2]=()=>{i("popper-show")}),onHide:o[3]||(o[3]=()=>{i("popper-hide")})},{default:t.withCtx(()=>{var n;return[t.createVNode(l.unref(F.ElScrollbar),{class:"k-input-scrollbar","max-height":((n=e.popperStyle)==null?void 0:n.maxHeight)??200},{default:t.withCtx(()=>{var $;return[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(c.value,(v,O)=>(t.openBlock(),t.createElementBlock("li",{key:v,class:p.normalizeClass(["k-input-option",{"is-selected":s.value===v,"is-highlight":a.value===O}]),onClick:()=>{E(v)}},p.toDisplayString(v),11,G))),128)),($=e.options)!=null&&$.length?t.createCommentVNode("",!0):t.renderSlot(e.$slots,"empty",{key:0},()=>[t.createElementVNode("div",J,p.toDisplayString(l.unref(y)("input.empty")),1)])]}),_:3},8,["max-height"])]}),_:3},8,["visible","width","virtual-ref","teleported","popper-style","popper-class"])):t.createCommentVNode("",!0)]),key:"2"}:{name:"suffix",fn:t.withCtx(()=>[t.renderSlot(e.$slots,"suffix"),e.showPassword&&s.value?(t.openBlock(),t.createElementBlock("div",{key:0,onClick:N},[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(f.value?l.unref(H.default):l.unref(A.default))))])):t.createCommentVNode("",!0)]),key:"3"}]),1040,["modelValue","class","prefix-icon","suffix-icon","type","size","placeholder"]))}});exports.default=Q;
