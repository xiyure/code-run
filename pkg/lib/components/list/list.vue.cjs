"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),T=require("../../hooks/use_locale.cjs"),E=require("../../node_modules/ksw-vue-icon/es/icons/base/loading.cjs"),C={key:0,class:"k-list-loading"},N={class:"k-list-default-loading"},V={key:1,class:"k-list-finished"},_={class:"k-list-default-finished"},R={class:"k-list-default-error"},b=e.defineComponent({name:"KList",__name:"list",props:{loading:{type:Boolean,default:!1},error:{type:Boolean,default:!1},finished:{type:Boolean,default:!1},offset:{default:0},loadingText:{},errorText:{},finishedText:{},disabled:{type:Boolean,default:!1},scroller:{},immediate:{type:Boolean,default:!0}},emits:["update:loading","update:error","load"],setup(g,{expose:h,emit:k}){const{t:d}=T.useLocale(),r=g,s=k;e.onMounted(()=>{var t,o;(o=(t=u.value)==null?void 0:t.addEventListener)==null||o.call(t,"scroll",i,{passive:!0}),r.immediate&&i()}),e.onUpdated(()=>{l.value=r.loading});const u=e.computed(()=>r.scroller?r.scroller:B(a.value)),a=e.ref(),f=e.ref(),l=e.ref(r.loading),v=/scroll|auto|overlay/i;e.watch(()=>[r.loading,r.error,r.finished],t=>{t[1]&&(l.value=!1,s("update:loading",!1)),i()});function y(){s("update:error",!1),i()}function i(){e.nextTick(()=>{if(l.value||r.finished||r.disabled||r.error)return;const t=+r.offset,o=p(u);if(!o.height||S(a))return;p(f).bottom-o.bottom<=t&&(l.value=!0,s("update:loading",!0),s("load"))})}function B(t){let o=t;for(;o&&o!==window&&o instanceof Element;){const{overflowY:n}=window.getComputedStyle(o);if(v.test(n))return o;o=o.parentNode}return t}function S(t){const o=e.unref(t);if(!o)return!1;const n=window.getComputedStyle(o),c=n.display==="none",w=o.offsetParent===null&&n.position!=="fixed";return c||w}function p(t){const o=e.unref(t);if(o===window){const n=o.innerWidth,c=o.innerHeight;return m(n,c)}return o!=null&&o.getBoundingClientRect?o.getBoundingClientRect():m(0,0)}function m(t,o){return{top:0,left:0,right:t,bottom:o,width:t,height:o}}return h({check:i}),(t,o)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"list",ref:a,class:"k-list"},[e.renderSlot(t.$slots,"default"),l.value&&!t.finished&&!t.error?(e.openBlock(),e.createElementBlock("div",C,[e.renderSlot(t.$slots,"loading",{},()=>[e.createElementVNode("div",N,[e.createVNode(e.unref(E.default)),e.createTextVNode(" "+e.toDisplayString(t.loadingText??e.unref(d)("list.loadingText")),1)])])])):e.createCommentVNode("",!0),t.finished&&!t.error?(e.openBlock(),e.createElementBlock("div",V,[e.renderSlot(t.$slots,"finished",{},()=>[e.createElementVNode("div",_,e.toDisplayString(t.finishedText??e.unref(d)("list.finishedText")),1)])])):e.createCommentVNode("",!0),t.error?(e.openBlock(),e.createElementBlock("div",{key:2,class:"k-list-error",onClick:y},[e.renderSlot(t.$slots,"error",{},()=>[e.createElementVNode("div",R,e.toDisplayString(t.errorText??e.unref(d)("list.errorText")),1)])])):e.createCommentVNode("",!0),e.createElementVNode("div",{ref_key:"placeholder",ref:f,class:"k-list-placeholder"},null,512)],512))}});exports.default=b;
