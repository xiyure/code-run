"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});require("../../node_modules/vue/dist/vue.runtime.esm-bundler.cjs");const C=require("../../hooks/use_locale.cjs"),E=require("../../node_modules/ksw-vue-icon/es/icons/base/loading.cjs"),o=require("../../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.cjs"),n=require("../../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.cjs"),f=require("../../node_modules/@vue/runtime-core/node_modules/@vue/shared/dist/shared.esm-bundler.cjs"),N={key:0,class:"k-list-loading"},V={class:"k-list-default-loading"},R={key:1,class:"k-list-finished"},b={class:"k-list-default-finished"},q={class:"k-list-default-error"},D=o.defineComponent({name:"KList",__name:"list",props:{loading:{type:Boolean,default:!1},error:{type:Boolean,default:!1},finished:{type:Boolean,default:!1},offset:{default:0},loadingText:{},errorText:{},finishedText:{},disabled:{type:Boolean,default:!1},scroller:{},immediate:{type:Boolean,default:!0}},emits:["update:loading","update:error","load"],setup(k,{expose:v,emit:y}){const{t:a}=C.useLocale(),r=k,d=y;o.onMounted(()=>{var e,t;(t=(e=p.value)==null?void 0:e.addEventListener)==null||t.call(e,"scroll",s,{passive:!0}),r.immediate&&s()}),o.onUpdated(()=>{i.value=r.loading});const p=o.computed(()=>r.scroller?r.scroller:w(c.value)),c=n.ref(),m=n.ref(),i=n.ref(r.loading),B=/scroll|auto|overlay/i;o.watch(()=>[r.loading,r.error,r.finished],e=>{e[1]&&(i.value=!1,d("update:loading",!1)),s()});function S(){d("update:error",!1),s()}function s(){o.nextTick(()=>{if(i.value||r.finished||r.disabled||r.error)return;const e=+r.offset,t=h(p);if(!t.height||T(c))return;h(m).bottom-t.bottom<=e&&(i.value=!0,d("update:loading",!0),d("load"))})}function w(e){let t=e;for(;t&&t!==window&&t instanceof Element;){const{overflowY:l}=window.getComputedStyle(t);if(B.test(l))return t;t=t.parentNode}return e}function T(e){const t=n.unref(e);if(!t)return!1;const l=window.getComputedStyle(t),u=l.display==="none",_=t.offsetParent===null&&l.position!=="fixed";return u||_}function h(e){const t=n.unref(e);if(t===window){const l=t.innerWidth,u=t.innerHeight;return g(l,u)}return t!=null&&t.getBoundingClientRect?t.getBoundingClientRect():g(0,0)}function g(e,t){return{top:0,left:0,right:e,bottom:t,width:e,height:t}}return v({check:s}),(e,t)=>(o.openBlock(),o.createElementBlock("div",{ref_key:"list",ref:c,class:"k-list"},[o.renderSlot(e.$slots,"default"),i.value&&!e.finished&&!e.error?(o.openBlock(),o.createElementBlock("div",N,[o.renderSlot(e.$slots,"loading",{},()=>[o.createElementVNode("div",V,[o.createVNode(n.unref(E.default)),o.createTextVNode(" "+f.toDisplayString(e.loadingText??n.unref(a)("list.loadingText")),1)])])])):o.createCommentVNode("",!0),e.finished&&!e.error?(o.openBlock(),o.createElementBlock("div",R,[o.renderSlot(e.$slots,"finished",{},()=>[o.createElementVNode("div",b,f.toDisplayString(e.finishedText??n.unref(a)("list.finishedText")),1)])])):o.createCommentVNode("",!0),e.error?(o.openBlock(),o.createElementBlock("div",{key:2,class:"k-list-error",onClick:S},[o.renderSlot(e.$slots,"error",{},()=>[o.createElementVNode("div",q,f.toDisplayString(e.errorText??n.unref(a)("list.errorText")),1)])])):o.createCommentVNode("",!0),o.createElementVNode("div",{ref_key:"placeholder",ref:m,class:"k-list-placeholder"},null,512)],512))}});exports.default=D;
